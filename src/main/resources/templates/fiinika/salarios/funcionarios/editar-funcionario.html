<!DOCTYPE html><!--  Last Published: Mon Jul 08 2024 14:53:42 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="66890f0693250e3d76acff1b" data-wf-site="667ada12e2b008b7d4b9eee9">
<head>
  <meta charset="utf-8">
  <title>Editar Funcionário</title>
  <meta content="Editar Funcionário" property="og:title">
  <meta content="Editar Funcionário" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="/css/normalize.css" rel="stylesheet" type="text/css">
  <link href="/css/components.css" rel="stylesheet" type="text/css">
  <link href="/css/fiinika-comercial-app.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Inter:300,regular,500,600,700","Barlow:100,200,300,regular,500,600,700,800,900"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="/images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="/images/webclip.png" rel="apple-touch-icon">
  
  <!--SWEET ALERT-->
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.1/dist/sweetalert2.min.css">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.1/dist/sweetalert2.min.js"></script>
  
</head>
<body>
  <div class="mother-div">
    <div class="close-flyout"></div>
	<div th:insert="/fragments/menuAdmin :: menuAdmin"></div>  
    <div class="page-content-wrapper">
      <div class="content">
        <section class="criar-page-section">
          <div class="container">
            <div class="top-section-navigation">
              <a href="javascript:history.back()" class="seta-para-tras w-inline-block">
                <div class="text-block-129">q</div>
              </a>
              <div class="titulo">
                <div class="text-block-130">Editar Funcionário<br></div>
              </div>
            </div>
            <div class="form-wrapper w-form">
			<form id="wf-form-Criar-Fatura" name="wf-form-Criar-Fatura" data-name="Criar Fatura"  method="POST" class="form" data-wf-page-id="6689081990f89437c7f0dc63" data-wf-element-id="e4cdf306-296b-3b25-3313-87c14bc3c666">
                <div class="form-section tighter">
                  <div class="w-layout-grid grid-12">
                    <div id="w-node-_61cbf681-b863-52c0-4009-b41d65e303df-c7f0dc63" class="criar-content-wrapper">
                      <div class="div-block-124">
                        <div>Dados pessoais</div>
                      </div>
                      <div class="form-field-wrapper"><label for="name" class="form-field-lable">Nome</label>
						<input th:each="funcionario, interator: ${funcionario}" class="form-text-field w-input" maxlength="256" name="name" data-name="Field 4" placeholder="" th:value="${funcionario.name}" type="text" id="name"></div>
                      <div class="form-field-wrapper"><label for="field-3" class="form-field-lable">Genero</label>
						<select id="gender" name="gender" data-name="Field 3" class="select-field w-select">
                          <option th:each="funcionario, interator: ${funcionario}" th:value="${funcionario.gender}">[[${funcionario.gender}]]</option>
                          <option value="Masculino">Masculino</option>
                          <option value="Feminino">Feminino</option>
                        </select>
                        <div class="div-block-100"></div>
                      </div>
                      <div class="form-field-wrapper"><label for="name" class="form-field-lable">NIF</label>
						<input th:each="funcionario, interator: ${funcionario}" class="form-text-field w-input" maxlength="256" name="nif" data-name="Field 2" placeholder="" th:value="${funcionario.nif}" type="text" id="nif"></div>
                      <div class="form-field-wrapper"><label for="name" class="form-field-lable">Morada</label>
						<input th:each="funcionario, interator: ${funcionario}" class="form-text-field w-input" maxlength="256" name="address" data-name="Field 2" placeholder="" th:value="${funcionario.address}" type="text" id="address"></div>
                      <div class="form-field-wrapper"><label for="name" class="form-field-lable">Número de telemóvel</label>
						<input th:each="funcionario, interator: ${funcionario}" class="form-text-field w-input" maxlength="256" name="phone" data-name="Field 2" placeholder="" th:value="${funcionario.phone}" type="text" id="phone" required></div>
                      <div class="form-field-wrapper"><label for="name" class="form-field-lable">Número de telemóvel (alternativo)</label>
						<input th:each="funcionario, interator: ${funcionario}" class="form-text-field w-input" maxlength="256" name="alt_phone" data-name="Field 2" placeholder="" th:value="${funcionario.alt_phone}" type="text" id="alt_phone"></div>
                      <div class="form-field-wrapper"><label for="name" class="form-field-lable">Email</label>
						<input th:each="funcionario, interator: ${funcionario}" class="form-text-field w-input" maxlength="256" name="email" data-name="Field 2" placeholder="" th:value="${funcionario.email}" type="text" id="email"></div>
						
						<!-- FOR PHOTO -->
			              <input type="file" accept="image/*" style="display:none" name="files" id="fileInput" onchange="preview_image(event)">
			              <input id="document" th:each="funcionario, interator: ${funcionario}" type="hidden" name="id_document" th:value="${funcionario.id_document}">
						
                      <div class="photo-upload-input-wrapper" th:each="funcionario, interator: ${funcionario}"><label for="Filtro-ano" class="form-field-lable">Bilhete de identidade</label>
						<label for="fileInput">
	                    <div class="photo-upload-input-field" id="take_div_upload">
	                      <div class="icon upload-icon">
	                        <div class="main-font-icon">4</div>
	                      </div>
	                      <div class="photo-upload-text">Clique para fazer upload</div>
	                      <div class="photo-upload-text small-gray">Ficheiro deve ter menos de 1MB</div>
	                    </div>
	                    </label>
	                    <div class="uploaded-photo-wrapper" id="display_div_upload">
	                      <div class="uploaded-photo-content">
	                        <div class="uploaded-photo-div">
	                          <div class="photo-contain" id="image"><img th:src="@{${'/imgs/uploads/' + funcionario.id_document}}" onerror="https://d3e54v103j8qbb.cloudfront.net/img/image-placeholder.svg" alt=""></div>
	                        </div>
	                        <div class="uploaded-photo-info">
	                          <div class="div-block-3">
	                            <div class="uploaded-image-name" id="file_name">[[${funcionario.id_document}]]</div>
	                            <div class="uploaded-image-resolution" id="file_res">200 x 180</div>
	                          </div>
	                        </div>
	                      </div>
	                      <div class="_3-buttons-wrapper">
	                        <label for="fileInput"> 
	                        <a class="action-button w-inline-block">
	                          <div class="icon quick-action">
	                            <div class="main-font-icon">w</div>
	                            <div class="button-text quick-action-text">Substituir</div>
	                          </div>
	                        </a>
	                        </label>
	                        <a href="#" class="action-button w-inline-block" id="remove-document">
	                          <div class="icon quick-action">
	                            <div class="main-font-icon">v</div>
	                            <div class="button-text quick-action-text">Eliminar</div>
	                          </div>
	                        </a>
	                        </div>
	                      </div>
	                    </div>
                      <div class="div-block-124">
                        <div>Dados profissionais</div>
                      </div>
                      <div class="form-field-wrapper"><label for="name" class="form-field-lable">IBAN para pagamento de salários</label>
						<input th:each="funcionario, interator: ${funcionario}" class="form-text-field w-input" maxlength="256" name="iban" data-name="Field 2" placeholder="" th:value="${funcionario.iban}" type="text" id="iban"></div>
                      <div class="form-field-wrapper"><label for="field-3" class="form-field-lable">Tipo de contrato</label>
						<select id="type_of_contract" name="type_of_contract" data-name="Field 3" class="select-field w-select" required>
							<option th:each="funcionario, interator: ${funcionario}" th:value="${funcionario.type_of_contract}">[[${funcionario.type_of_contract}]]</option>							
							<option value="Tempo indeterminado">Tempo indeterminado</option>
							<option value="Tempo determinado">Tempo determinado</option>
							<option value="Trabalho temporário">Trabalho temporário</option>
							<option value="Trabalho autônomo">Trabalho autônomo</option>
							<option value="Prestação de serviços">Prestação de serviços</option>
							<option value="Trabalho terceirizado">Trabalho terceirizado</option>
							<option value="Trabalho intermitente">Trabalho intermitente</option>
                        </select>
                        <div class="div-block-100"></div>
                      </div>
					  <div class="form-field-wrapper">
					      <label for="field-3" class="form-field-lable">Categoria do funcionário</label>
					      <select id="category_id" name="category" data-name="Field 3" class="select-field w-select" onchange="getSalary(this.value)" required>
							<option th:each="funcionario, interator: ${funcionario}" th:value="${funcionario.category}">[[${funcionario.category_name}]]</option>
					          <option th:each="categorias, interator: ${categorias}" th:value="${categorias.id}">[[${categorias.name}]]</option>
					      </select>
					      <div class="div-block-100"></div>
					  </div>
					  <div class="parceiro-info-seperator saldo" th:each="funcionario, interator: ${funcionario}">
					      <div class="form-field-label-2">Salário base previsto (segundo a categoria)</div>
					      <div class="parceiro-text-field saldo" id="prev">[[${funcionario.base_salary}]]</div>
					      <div class="do _9">
					          <label for="field-5" class="form-field-lable">Inserir manualmente o salário base</label>
					          <input class="form-text-field w-input" maxlength="256" name="base_salary" data-name="Field 2" placeholder="KZ" type="text" id="base_salary" required="" th:value="${funcionario.base_salary}" onblur="formatSalary(this)" oninput="validateSalaryInput(this)">
					      </div>
					  </div>
					  <div class="form-field-wrapper">
					      <label for="name" class="form-field-lable">Horas de trabalho</label>
					      <input th:each="funcionario, interator: ${funcionario}" class="form-text-field w-input" maxlength="256" name="hours_per_day" data-name="Field 2" placeholder="" th:value="${funcionario.hours_per_day}" type="text" id="hours_per_day" oninput="validateHoursPerDay(this)" required>
					  </div>
					  <div class="form-field-wrapper">
					      <label for="name" class="form-field-lable">Quantos dias por semana?</label>
					      <input th:each="funcionario, interator: ${funcionario}" class="form-text-field w-input" maxlength="256" name="days_per_week" data-name="Field 2" placeholder="" th:value="${funcionario.days_per_week}" type="number" id="days_per_week" oninput="validateDaysPerWeek(this)" required>
					  </div>
					  <div class="form-field-wrapper">
					      <label for="name" class="form-field-lable">Data de ingresso</label>
					      <input th:each="funcionario, interator: ${funcionario}" class="form-text-field w-input" maxlength="256" name="admission_date" data-name="Field 2" placeholder="" th:value="${funcionario.admission_date}" type="date" id="admission_date" required>
					  </div>
                    </div>
					<div id="w-node-_4c58ef52-b513-d4bb-0690-d5e887b70263-c7f0dc63" class="criar-content-wrapper">
					    <div class="div-block-124">
					        <div>Subsídios</div>
					    </div>
					    <div class="subsidios-div">
					        <div class="div-block-125" th:each="retribuicoes, interator: ${retribuicoes}">
					            <label class="w-checkbox checkbox-field-2">
					                <input type="checkbox" th:id="@{'checkbox_r'+${retribuicoes.id}}" name="retributions_" data-name="Checkbox" th:value="${retribuicoes.id}" class="w-checkbox-input checkbox-2">
					                <span class="checkbox-label w-form-label" for="checkbox">[[${retribuicoes.name}]]</span>
					            </label>
					            <input class="form-text-field w-input" maxlength="256" name="field-4" data-name="Field 4" placeholder="KZ" type="text" th:id="@{'checkbox_inputr'+${retribuicoes.id}}">
					        </div>
					    </div>
					    <div class="div-block-124">
					        <div>Deduções</div>
					    </div>
					    <div class="dedu-es-div">
					        <div class="div-block-125" th:each="deducoes, interator: ${deducoes}">
					            <label class="w-checkbox checkbox-field-2">
					                <input type="checkbox" th:id="@{'checkbox_d'+${deducoes.id}}" name="deductions_" data-name="Checkbox" th:value="${deducoes.id}" class="w-checkbox-input checkbox-2">
					                <span class="checkbox-label w-form-label" for="checkbox">[[${deducoes.name}]]</span>
					            </label>
					            <input class="form-text-field w-input" maxlength="256" name="field-4" data-name="Field 4" placeholder="KZ" type="text" th:id="@{'checkbox_inputd'+${deducoes.id}}">
					        </div>
					        <div class="form-field-wrapper">
					            <label for="name" class="form-field-lable">IRT</label>
					            <input class="form-text-field w-input" maxlength="256" name="irt_fee" data-name="Field 2" placeholder="" readonly type="text" id="irt_fee">
					            <a href="https://irt.minfin.gov.ao/irt" target="blank_" class="link-5">Mapa IRT nacional (ver)</a>
					        </div>
					        <div class="_40-2">
					            <label for="Categoria-do-anuncio" class="form-field-label-3">INSS (3%)</label>
					            <div class="parceiro-text-field saldo-copy" id="inss_3">00.00<span class="kz thin-kz">KZ</span></div>
					        </div>
					        <div class="_40-3">
					            <label for="Categoria-do-anuncio" class="form-field-label-4">INSS EMPRESA (8%)</label>
					            <div class="parceiro-text-field saldo-copy" id="inss_8">00.00<span class="kz thin-kz">KZ</span></div>
					        </div>
					    </div>
					    <div class="resumo-table">
					        <div class="resumo-item-block w-clearfix">
					            <div class="resumo-description">Valor base</div>
					            <div class="resumo-cash" id="base_value">0,00<span class="currency-2">KZ</span></div>
					        </div>
					        <div class="resumo-item-block w-clearfix">
					            <div class="resumo-description">Retribuições</div>
					            <div class="resumo-cash" id="total_ret">0,00<span class="currency-2">KZ</span></div>
					        </div>
					        <div class="resumo-item-block w-clearfix">
					            <div class="resumo-description">Deduções</div>
					            <div class="resumo-cash" id="total_ded">0,00<span class="currency-2">KZ</span></div>
					        </div>
					        <div class="resumo-item-block w-clearfix">
					            <div class="resumo-description">Total KZ</div>
					            <div class="resumo-cash" id="total_kwanza">0,00<span class="currency-2">KZ</span></div>
					        </div>
					        <div class="resumo-item-block w-clearfix">
					            <div class="resumo-description">Total Euro</div>
					            <div class="resumo-cash" id="total_euro">0,00<span class="currency-2">KZ</span></div>
					        </div>
					        <div class="resumo-item-block w-clearfix">
					            <div class="resumo-description">Total USD</div>
					            <div class="resumo-cash" id="total_dollar">0,00<span class="currency-2">KZ</span></div>
					        </div>
					    </div>
					    <div class="create-div">
					        <a href="#" class="button main w-button" onclick="submitForm();">Guardar</a>
					        <input id="submit" type="submit" style="display:none;" value="guardar"/>
					    </div>
					
					    <!-- Hidden inputs for storing IDs and total values -->
					    <input th:each="funcionario, interator: ${funcionario}" type="hidden" id="retribution_ids" name="retributions" th:value="${funcionario.retributions}">
					    <input th:each="funcionario, interator: ${funcionario}" type="hidden" id="deduction_ids" name="deductions" th:value="${funcionario.deductions}">						
						<input th:each="funcionario, interator: ${funcionario}" type="hidden" id="inss" name="inss" th:value="${funcionario.inss}">						
						<input th:each="funcionario, interator: ${funcionario}" type="hidden" id="inss_company" name="inss_company" th:value="${funcionario.inss_company}">
					    <input th:each="funcionario, interator: ${funcionario}" type="hidden" id="total_retributions" name="total_retributions">
					    <input th:each="funcionario, interator: ${funcionario}" type="hidden" id="total_deductions" name="total_deductions">
					    <input th:each="funcionario, interator: ${funcionario}" type="hidden" id="total_kwanza_value" name="total_salary_kwanza">
					    <input th:each="funcionario, interator: ${funcionario}" type="hidden" id="total_euro_value" name="total_salary_euro">
					    <input th:each="funcionario, interator: ${funcionario}" type="hidden" id="total_dollar_value" name="total_salary_dollar">						
						<input th:each="funcionario, interator: ${funcionario}" type="hidden" id="status" name="status" th:value="${funcionario.status}">						
						<input th:each="funcionario, interator: ${funcionario}" type="hidden" id="user_type" name="user_type" th:value="${funcionario.user_type}"/>						
						<input th:each="funcionario, interator: ${funcionario}" type="hidden" id="user_id" name="id" th:value="${funcionario.id}"/>						
						<input th:each="funcionario, interator: ${funcionario}" type="hidden" id="subsidy_other" name="subsidy_other" th:value="${funcionario.subsidy_other}"/>					
						<input th:each="funcionario, interator: ${funcionario}" type="hidden" id="extra_hours" name="extra_hours" th:value="${funcionario.extra_hours}" />
					</div>
                  </div>
                </div>
              </form>
              <!--<div class="w-form-done">
                <div>Thank you! Your submission has been received!</div>
              </div>
              <div class="w-form-fail">
                <div>Oops! Something went wrong while submitting the form.</div>
              </div>-->
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
  <div class="not-valid">
    <div class="text-block-116">Dimensão de ecrã não suportada...</div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=667ada12e2b008b7d4b9eee9" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="/js/fiinika-comercial-app.js" type="text/javascript"></script>

  <script th:inline="javascript">
	
	
	
	
	
	
	validateDocument();
	function validateDocument(){
		const doc = document.getElementById("document").value;
		var take_div_upload = document.getElementById("take_div_upload");
		var display_div_upload = document.getElementById("display_div_upload");
				      
			console.log("DOC: "+ doc);	     
		if(doc == "blank-profile-picture.jpeg" || doc == null){
			take_div_upload.style.display = "block";
			display_div_upload.style.display = "none";
		}else{
			take_div_upload.style.display = "none";
			display_div_upload.style.display = "Block";
		}
			if(doc.includes(".pdf")){
				document.getElementById("image").innerHTML = "<div class='photo-contain pdf'><img src='/images/PDF_file_icon.svg.png' sizes='100vw' srcset='/images/PDF_file_icon.svg-p-500.png 500w, /images/PDF_file_icon.svg-p-800.png 800w, /images/PDF_file_icon.svg-p-1080.png 1080w, /images/PDF_file_icon.svg.png 1200w' alt='' class='pdf'></div>";
			}
	}
	
	
	
	 /*<![CDATA[*/
	    var retribuicoes = /*[[${retribuicoes}]]*/ 'default';
	    var deducoes = /*[[${deducoes}]]*/ 'default';
	    var empresa = /*[[${empresa}]]*/ 'default';
	    /*]]>*/
		
		// Function to fetch and update the salary based on the selected category
			  	function getSalary(val) {
			  	    var url = "/ajax_get_category_details";
			  	    var id_cat = val;
			  	    $.ajax({
			  	        type: "POST",
			  	        url: url,
			  	        data: {'id_cat': id_cat},
			  	        success: function(data) {
			  	            if (data) {
			  	                var formattedSalary = formatCurrency(data, 'KZ');
			  	                var baseSalaryElement = document.getElementById("base_salary");
			  	                
			  	                if (baseSalaryElement) {
			  	                    document.getElementById("prev").innerHTML = formattedSalary;
			  	                    baseSalaryElement.value = formattedSalary;
			  	                    updateTotals();
			  	                } else {
			  	                    console.error("Element with id 'base_salary' not found");
			  	                }
			  	            } else {
			  	                console.error("Base salary data is missing or incorrect");
			  	            }
			  	        },
			  	        error: function(xhr, status, error) {
			  	            console.error("Failed to fetch base salary:", error);
			  	        }
			  	    });
			  	}
		  
			  	function calculateIRT(grossSalary) {
			        let irt = 0;
			        if (grossSalary > 500000) {
			            irt += (grossSalary - 500000) * 0.20;
			            grossSalary = 500000;
			        }
			        if (grossSalary > 300000) {
			            irt += (grossSalary - 300000) * 0.19;
			            grossSalary = 300000;
			        }
			        if (grossSalary > 200000) {
			            irt += (grossSalary - 200000) * 0.18;
			            grossSalary = 200000;
			        }
			        if (grossSalary > 150000) {
			            irt += (grossSalary - 150000) * 0.16;
			            grossSalary = 150000;
			        }
			        if (grossSalary > 100000) {
			            irt += (grossSalary - 100000) * 0.13;
			            grossSalary = 100000;
			        }
			        if (grossSalary > 70000) {
			            irt += (grossSalary - 70000) * 0.10;
			        }
			        return irt;
			    }

			    function formatCurrency(value, currency) {
			        if (!value) {
			            return "0.00";  // Default value
			        }
			        var num = parseFloat(value.replace(/[^0-9.-]+/g, ""));
			        if (currency === 'KZ') {
			            return 'KZ ' + num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
			        }
			        return num.toLocaleString('en-US', { style: 'currency', currency: currency });
			    }

			    function formatSalary(input) {
			        var value = input.value.replace(/[^0-9.-]+/g, "");
			        if (value) {
			            var formattedValue = formatCurrency(value, 'KZ');
			            input.value = formattedValue;
			            document.getElementById("prev").innerHTML = formattedValue;
			        }
			    }

			    function validateSalaryInput(input) {
			        input.value = input.value.replace(/[^0-9.,]/g, '');
			    }

			    function validateHoursPerDay(input) {
			        var value = parseInt(input.value, 10);
			        if (isNaN(value) || value < 1) {
			            input.value = 1;
			        } else if (value > 24) {
			            input.value = 24;
			        }
			        input.value = input.value.replace(/[^0-9]/g, '');
			    }

			    function validateDaysPerWeek(input) {
			        var value = parseInt(input.value, 10);
			        if (isNaN(value) || value < 1) {
			            input.value = 1;
			        } else if (value > 7) {
			            input.value = 7;
			        }
			        input.value = input.value.replace(/[^0-9]/g, '');
			    }

			    function parseCurrency(value) {
			        return parseFloat(value.replace(/[^\d.-]/g, '')) || 0;
			    }

			    function getValueById(id) {
			        var value = document.getElementById(id).value.replace(/[^0-9.-]+/g, "");
			        return parseFloat(value) || 0;
			    }

			    function setValueById(id, value, currency = 'KZ') {
			        document.getElementById(id).value = formatCurrency(value.toString(), currency);
			    }

			    function updateINSS(baseSalary) {
			        var inss3 = baseSalary * 0.03;
			        var inss8 = baseSalary * 0.08;
			        document.getElementById('inss_3').innerText = formatCurrency(inss3.toString(), 'KZ');
			        document.getElementById('inss').value = formatCurrency(inss3.toString(), 'KZ');
			        document.getElementById('inss_8').innerText = formatCurrency(inss8.toString(), 'KZ');
			        document.getElementById('inss_company').value = formatCurrency(inss8.toString(), 'KZ');
			    }

			    function updateTotals() {
			        var baseSalary = getValueById('base_salary');
			        var totalRetributions = 0;
			        var totalDeductions = 0;
			        var otherSubsidiesTotal = 0;
			        var retributionValues = [];
			        var deductionValues = [];

			        // Iterate through retributions
			        document.querySelectorAll('input[name="retributions_"]').forEach(function(checkbox) {
			            var id = checkbox.id.replace('checkbox_r', '');
			            var inputField = document.getElementById('checkbox_inputr' + id);
			            var value = 0;

			            if (checkbox.checked) {
			                var retribuicao = retribuicoes.find(item => item.id == id);

			                if (retribuicao.incidence === 'Salário base') {
			                    value = parseCurrency(retribuicao.set_value);
			                } else if (retribuicao.incidence === 'Despesa da empresa') {
			                    value = baseSalary * (parseFloat(retribuicao.percentage) / 100);
			                } else {
			                    value = parseCurrency(inputField.value.replace('KZ ', '')); // Allow manual input
			                }

			                // Set name attribute based on retribuicao.status
			                switch (retribuicao.status) {
			                    case "CH":
			                        inputField.name = "subsidy_christmas";
			                        inputField.required = true;
			                        break;
			                    case "EX":
			                        inputField.name = "subsidy_executive";
			                        inputField.required = true;
			                        break;
			                    case "FA":
			                        inputField.name = "subsidy_family";
			                        inputField.required = true;
			                        break;
			                    case "FO":
			                        inputField.name = "subsidy_food";
			                        inputField.required = true;
			                        break;
			                    case "RE":
			                        inputField.name = "subsidy_rent";
			                        inputField.required = true;
			                        break;
			                    case "TR":
			                        inputField.name = "subsidy_transport";
			                        inputField.required = true;
			                        break;
			                    case "VA":
			                        inputField.name = "subsidy_vacation";
			                        inputField.required = true;
			                        break;
			                    default:
			                        otherSubsidiesTotal += value;
			                }

			                setValueById('checkbox_inputr' + id, value, 'KZ');
			                totalRetributions += value;
			                retributionValues.push({id: id, value: value });
			            } else {
			                inputField.value = '0.00 KZ';
			            }
			        });

			        // Iterate through deductions
			        document.querySelectorAll('input[name="deductions_"]').forEach(function(checkbox) {
			            var id = checkbox.id.replace('checkbox_d', '');
			            var inputField = document.getElementById('checkbox_inputd' + id);
			            var value = 0;

			            if (checkbox.checked) {
			                var deducao = deducoes.find(item => item.id == id);

			                if (deducao.incidence === 'Salário base') {
			                    value = parseCurrency(deducao.set_value);
			                } else if (deducao.incidence === 'Despesa da empresa') {
			                    value = baseSalary * (parseFloat(deducao.percentage) / 100);
			                } else {
			                    value = parseCurrency(inputField.value); // Allow manual input
			                }

			                setValueById('checkbox_inputd' + id, value, 'KZ');
			                totalDeductions += value;
			                deductionValues.push({ id: id, value: value });
			            } else {
			                inputField.value = '0.00 KZ';
			            }
			        });

			        // Update INSS
			        updateINSS(baseSalary);
			        totalDeductions += parseCurrency(document.getElementById('inss').value);

			        // Calculate and update IRT
			        var grossSalary = baseSalary + totalRetributions;
			        var irt = calculateIRT(grossSalary);
			        setValueById('irt_fee', irt, 'KZ');
			        totalDeductions += irt;

			        // Update total fields
			        var totalKZ = baseSalary + totalRetributions - totalDeductions;
			        document.getElementById('base_value').innerText = formatCurrency(baseSalary.toString(), 'KZ');
			        document.getElementById('total_ret').innerText = formatCurrency(totalRetributions.toString(), 'KZ');
			        document.getElementById('total_ded').innerText = formatCurrency(totalDeductions.toString(), 'KZ');
			        document.getElementById('total_kwanza').innerText = formatCurrency(totalKZ.toString(), 'KZ');

			        var usd = 900.01;
			        var euro = 900.01;
			        empresa.forEach(function(cambio) {
			            euro = parseFloat(cambio.cambioEuro),
			            usd = parseFloat(cambio.cambioDollar)
			            console.log("DOLLAR: "+ cambio.cambioEuro)
			        });

			        // Assume conversion rates for demonstration purposes
			        var conversionRates = {
			            KZtoEuro: euro,
			            KZtoUSD: usd
			        };
			        var totalEuro = totalKZ / conversionRates.KZtoEuro;
			        var totalDollar = totalKZ / conversionRates.KZtoUSD;
			        document.getElementById('total_euro').innerText = formatCurrency(totalEuro.toString(), 'EUR');
			        document.getElementById('total_dollar').innerText = formatCurrency(totalDollar.toString(), 'USD');

			        // Update hidden inputs
			        document.getElementById('retribution_ids').value = JSON.stringify(retributionValues);
			        document.getElementById('deduction_ids').value = JSON.stringify(deductionValues);
			        document.getElementById('total_retributions').value = formatCurrency(totalRetributions.toString(), 'KZ');
			        document.getElementById('total_deductions').value = formatCurrency(totalDeductions.toString(), 'KZ');
			        document.getElementById('total_kwanza_value').value = formatCurrency(totalKZ.toString(), 'KZ');
			        document.getElementById('total_euro_value').value = formatCurrency(totalEuro.toString(), 'EUR');
			        document.getElementById('total_dollar_value').value = formatCurrency(totalDollar.toString(), 'USD');

			        // Set the value for the other subsidies in a hidden input
			        document.getElementById('subsidy_other').value = formatCurrency(otherSubsidiesTotal.toString(), 'KZ');
			    }

			    function checkInitialCheckboxes() {
			        var retributionIds = JSON.parse(document.getElementById('retribution_ids').value || '[]');
			        var deductionIds = JSON.parse(document.getElementById('deduction_ids').value || '[]');

			        retributionIds.forEach(function(item) {
			            var checkbox = document.getElementById('checkbox_r' + item.id);
			            if (checkbox) {
			                checkbox.checked = true;
			                document.getElementById('checkbox_inputr' + item.id).value = item.value;
			            }
			        });

			        deductionIds.forEach(function(item) {
			            var checkbox = document.getElementById('checkbox_d' + item.id);
			            if (checkbox) {
			                checkbox.checked = true;
			                document.getElementById('checkbox_inputd' + item.id).value = item.value;
			            }
			        });
			    }

			    // Event listener for checkboxes
			    document.querySelectorAll('input[type="checkbox"]').forEach(function(checkbox) {
			        checkbox.addEventListener('change', function() {
			            if (!checkbox.checked) {
			                var id = checkbox.id.replace('checkbox_r', '');
			                if(checkbox.name == "retributions_"){
			                    document.getElementById('checkbox_inputr' + id).value = '0.00 KZ';
			                }

			                var id2 = checkbox.id.replace('checkbox_d', '');
			                if(checkbox.name == "deductions_"){
			                    document.getElementById('checkbox_inputd' + id2).value = '0.00 KZ';
			                }
			            }
			            updateTotals();
			        });
			    });

			    // Event listener for input fields
			    document.querySelectorAll('input[type="text"]').forEach(function(input) {
			        input.addEventListener('input', function() {
			            updateTotals();
			        });
			    });

			    // Initial calculation on page load
			    document.addEventListener('DOMContentLoaded', function() {
			        checkInitialCheckboxes();
			        updateTotals();
			    });
	</script>
  
  
    <script >
  	
  	
  	
  	
  	
  	
  	//FOR IMAGE
  	
  	function getImageResolution(imageFile) {
  	    return new Promise((resolve, reject) => {
  	      const img = new Image();
  	
  	      img.onload = function () {
  	        resolve({ width: img.width, height: img.height });
  	      };
  	
  	      img.onerror = function (error) {
  	        reject(error);
  	      };
  	
  	      const reader = new FileReader();
  	
  	      reader.onload = function (e) {
  	        img.src = e.target.result;
  	      };
  	
  	      reader.readAsDataURL(imageFile);
  	    });
  	  }
  	$('#remove-document').on('click', function(){
  	 document.getElementById("file_name").innerHTML = "<div class='uploaded-image-name' id='file_name'>sem-imagem.png</div>";
  	 document.getElementById("image").innerHTML = "<div class='photo-contain'><img src='https://d3e54v103j8qbb.cloudfront.net/img/image-placeholder.svg' alt=''></div>";
  	 document.getElementById("document").value='no-image.jpeg';
  	});
  	
  	function preview_image(event){
  		var previewInner = "<div class='photo-contain' id='image1'><img src='/images/pdf-icon.png' sizes='100vw' srcset='/images/pdf-icon-p-500.png 500w, /images/pdf-icon.png 512w'></div>";
  		//var file_input = $("#fileInput").value
  		var file_extension = $("#fileInput").val().split('.').pop();
  		
  		if(file_extension == "png"  || file_extension == "jpeg" || file_extension == "jpg" || file_extension == "pdf"){
  			
  				previewInner = "<div class='photo-contain'><img style='max-width: 100%; max-height: 100%; display: block;' id='output_image'></div>";
  				
  				if(file_extension == "pdf"){
  					previewInner ="<div class='photo-contain pdf'><img src='/images/PDF_file_icon.svg.png' sizes='100vw' srcset='/images/PDF_file_icon.svg-p-500.png 500w, /images/PDF_file_icon.svg-p-800.png 800w, /images/PDF_file_icon.svg-p-1080.png 1080w, /images/PDF_file_icon.svg.png 1200w' alt='' class='pdf'></div>";
  				}
  				
  				document.getElementById("image").innerHTML = previewInner;
  				var reader = new FileReader();
  				reader.onload = function(){
  				var output = document.getElementById('output_image');
  			
  			     var file_name =$("#fileInput").val().split("\\").pop();
  			         $("#file_name").html(file_name)
  			  
  			  
  				  const imageFile = event.target.files[0];
  			      getImageResolution(imageFile).then(resolution => {
  			        console.log(`Image Resolution: ${resolution.width} x ${resolution.height}`);
  			        document.getElementById("file_res").innerText=`${resolution.width} x ${resolution.height}`;
  			      });
  			      
  			 	output.src = reader.result;
  			    var take_div_upload = document.getElementById("take_div_upload");
  			    var display_div_upload = document.getElementById("display_div_upload");
  			      take_div_upload.style.display = "none";
  			      display_div_upload.style.display = "block";
  				}
  				reader.readAsDataURL(event.target.files[0]);
  		}
  		else{
  			//imageOnlyError()
  		}		
  	}
  	
  	
  	//SWEET ALERTS
  	function imageOnlyError(){
  	    Swal.fire({
  	        icon: 'error',
  	        title: 'Erro',
  	        text: 'Somente arquivos PNG, JPG, JPEG OU PDF são aceitos!',
  	    });
  	}
  	
  	
  	
  	
  	
  	
  	
      	
      	
      //TO SUBMIT FORM
      function submitForm(){
      	
      	document.getElementById('submit').click();
      		  
      }
      
      $(document).ready(function() {
              $('form').submit(function(event) {
                  event.preventDefault(); // Evita que o formulário seja enviado normalmente
      
                  const loadingSwal = Swal.fire({
                      title: "Aguarde...",
                      didOpen: () => {
                          Swal.showLoading()
                      },
    				  allowOutsideClick: false,
                  });
      
                  // Crie um objeto FormData para o formulário
                  const formData = new FormData(this);
      
                  // Envie os dados via AJAX usando FormData
                  const url = "/edit-funcionario";
                  $.ajax({
                      type: "POST",
                      url: url,
                      data: formData,
                      processData: false, // Não processar o FormData (já está em um formato adequado para envio)
                      contentType: false, // Não definir o tipo de conteúdo (o navegador irá definir como 'multipart/form-data')
                      success: function(data) {
                          // Esconda a animação de carregamento
                          
                          //alert(data);
                          // Lógica para manipular a resposta do servidor
                          console.log(data.id)
                          
    						loadingSwal.close();
                              window.location.href = "/fiinika/salarios/funcionarios/perfil-do-funcionario/"+data.id;
                          
                          
                      },
                      error: function(xhr, textStatus, errorThrown) {
                          // Esconda a animação de carregamento
                          loadingSwal.close();
      
                          // Mostre a mensagem de erro
                          Swal.fire({
                              title: "Erro!",
                              text: xhr.responseText,
                              icon: "error"
                          });
                      }
                  });
              });
          });	
      	
      </script> 
  
 </body>
</html>