<!DOCTYPE html><!--  Last Published: Mon Jul 08 2024 14:53:42 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="66892122c0bff26f3853913e" data-wf-site="667ada12e2b008b7d4b9eee9">
<head>
  <meta charset="utf-8">
  <title>Editar dedução</title>
  <meta content="Editar dedução" property="og:title">
  <meta content="Editar dedução" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="/css/normalize.css" rel="stylesheet" type="text/css">
  <link href="/css/components.css" rel="stylesheet" type="text/css">
  <link href="/css/fiinika-comercial-app.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Inter:300,regular,500,600,700","Barlow:100,200,300,regular,500,600,700,800,900"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="/images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="/images/webclip.png" rel="apple-touch-icon">
  
  <!--SWEET ALERT-->
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.1/dist/sweetalert2.min.css">
          <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.1/dist/sweetalert2.min.js"></script>
  
</head>
<body>
  <div class="mother-div">
    <div class="html-embed w-embed"></div>
    <div class="close-flyout"></div>
    <div class="page-content-wrapper">
		<div th:insert="/fragments/menuAdmin :: menuAdmin"></div>
      <div class="content">
        <section class="criar-page-section container">
          <div class="container">
            <div class="form-wrapper w-form">
              <div class="top-section-navigation">
                <a href="javascript:history.back()" class="seta-para-tras w-inline-block">
                  <div class="text-block-129">q</div>
                </a>
                <div class="titulo">
                  <div class="text-block-130">Editar dedução<br></div>
                </div>
              </div>
              <form id="wf-form-Criar-Fatura" name="wf-form-Criar-Fatura" data-name="Criar Fatura" th:each="deducao, interator: ${deducao}" method="get" class="form" data-wf-page-id="66892122c0bff26f3853913e" data-wf-element-id="e4cdf306-296b-3b25-3313-87c14bc3c666">
				<div class="form-section tighter">
                  <div class="criar-content-wrapper">
                    <div class="form-field-wrapper"><label for="name" class="form-field-lable">Nome da dedução</label>
						<input class="form-text-field w-input" maxlength="256" name="name" data-name="Field" placeholder="" type="text" id="name" th:value="${deducao.name}" required></div>
                    <div class="form-field-wrapper"><label for="field-3" class="form-field-lable">Incidência</label>
						<select id="incidence" name="incidence" data-name="Field 3" class="select-field w-select" onchange="selectedInstance(this.value)" required>
                        <option th:value="${deducao.incidence}">[[${deducao.incidence}]]</option>						
						<option value="Salário base">Salário base</option>
						<option value="Despesa da empresa">Despesa da empresa</option>
                      </select></div>
                    <div class="form-field-wrapper" th:if="${deducao.percentage} != 0"><label for="field-2" id="label" class="form-field-lable">Percentual</label>
						<input class="form-text-field w-input" maxlength="256" name="percentage" data-name="Field 2" placeholder="%" type="number" id="percentage" oninput="validatePercentage(this)"  th:value="${deducao.percentage}">
					    <input class="form-text-field w-input" maxlength="256" name="set_value" data-name="Field 2" style="display: none;" placeholder="00.00" type="text" id="set_value" onblur="formatSalary(this)" oninput="validateSalaryInput(this)" th:value="${deducao.set_value}"></div>						
					<div class="form-field-wrapper" th:unless="${deducao.percentage} != 0"><label for="field-2" id="label" class="form-field-lable">Valor fixo</label>
						<input class="form-text-field w-input" maxlength="256" name="percentage" data-name="Field 2" style="display: none;" placeholder="%" type="number" id="percentage" oninput="validatePercentage(this)" th:value="${deducao.percentage}">
					    <input class="form-text-field w-input" maxlength="256" name="set_value" data-name="Field 2" placeholder="00.00" type="text" id="set_value" onblur="formatSalary(this)" oninput="validateSalaryInput(this)" th:value="${deducao.set_value}"></div>
                    
						<!-- EXTRAS  -->
			                  <input id="creation_date" type="hidden" name="creation_date" th:value="${deducao.creation_date}"/>								  
							  <input id="targets" type="hidden" name="targets" th:value="${deducao.targets}"/>							  
							  <input id="id" type="hidden" name="id" th:value="${deducao.id}"/>	
						
					<div class="create-div">
                      <a href="#" class="button main w-button" onclick="submitForm();">Guardar</a>
					  <input id="submit" type="submit" style="display:none;" value="Guardar"/>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=667ada12e2b008b7d4b9eee9" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="/js/fiinika-comercial-app.js" type="text/javascript"></script>

  <script th:inline="javascript">
  	
  	
          function selectedInstance(val) {
  			
  			if(val == 'Salário base'){
  					
  				document.getElementById("label").innerHTML = "Valor fixo";
  	            document.getElementById("set_value").style.display="block";
  				document.getElementById("percentage").style.display="none";				
  				document.getElementById("percentage").value=0;
  				
  			}
  				 
  			if(val == 'Despesa da empresa'){
  				
  				document.getElementById("label").innerHTML = "Percentual";
  				document.getElementById("percentage").style.display="block";					
  				document.getElementById("set_value").style.display="none";					
  				document.getElementById("set_value").value="00.00";
  				
  			}
          }
      
          
  		function formatCurrency(value) {
              if (!value) {
                  return "00.00";  // Default value
              }
              var num = parseFloat(value.replace(/[^0-9.-]+/g, ""));
              return num.toLocaleString('en-US', { style: 'currency', currency: 'AOA' }).replace('AOA', 'KZ');
          }
      
          function formatSalary(input) {
              var value = input.value.replace(/[^0-9.-]+/g, "");
              if (value) {
                  var formattedValue = formatCurrency(value);
                  input.value = formattedValue;
              }
          }
      
          function validateSalaryInput(input) {
              input.value = input.value.replace(/[^0-9.,]/g, '');
          }
      
          function validatePercentage(input) {
              var value = parseInt(input.value, 10);
              if (isNaN(value) || value <= 0) {
                  input.value = 0;
              } else if (value > 100) {
                  input.value = 100;
              }
              input.value = input.value.replace(/[^0-9]/g, '');
          }
    	  
    	  
      </script>
    
    
      <script >
        	
        	
        //TO SUBMIT FORM
        function submitForm(){
        	
        	document.getElementById('submit').click();
        		  
        }
        
        $(document).ready(function() {
                $('form').submit(function(event) {
                    event.preventDefault(); // Evita que o formulário seja enviado normalmente
        
                    const loadingSwal = Swal.fire({
                        title: "Aguarde...",
                        didOpen: () => {
                            Swal.showLoading()
                        },
      				  allowOutsideClick: false,
                    });
        
                    // Crie um objeto FormData para o formulário
                    const formData = new FormData(this);
        
                    // Envie os dados via AJAX usando FormData
                    const url = "/edit-deducao";
                    $.ajax({
                        type: "POST",
                        url: url,
                        data: formData,
                        processData: false, // Não processar o FormData (já está em um formato adequado para envio)
                        contentType: false, // Não definir o tipo de conteúdo (o navegador irá definir como 'multipart/form-data')
                        success: function(data) {
  						
                            console.log(data)
      						loadingSwal.close();
  							
  							Swal.fire({
  		                        icon: 'success',
  		                        title: 'Dedução atualizado!',
  		                        text: 'A dedução foi atualizado com sucesso.',
  		                        timer: 1500,
  		                        showConfirmButton: false
  		                    }).then(() => {
								window.location.href = "/fiinika/salarios/retribuicoes-e-deducoes/deducoes-e-retribuicoes-main";
							 });															
								                              
                        },
                        error: function(xhr, textStatus, errorThrown) {
                            // Esconda a animação de carregamento
                            loadingSwal.close();
        
                            // Mostre a mensagem de erro
                            Swal.fire({
                                title: "Erro!",
                                text: xhr.responseText,
                                icon: "error"
                            });
                        }
                    });
                });
            });	
        	
        </script> 
  
 </body>
</html>