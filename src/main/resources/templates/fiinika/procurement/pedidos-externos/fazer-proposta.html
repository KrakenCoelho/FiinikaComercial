<!DOCTYPE html><!--  Last Published: Fri Jul 12 2024 13:58:39 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="669073fb64c37aed5792802d" data-wf-site="667ada12e2b008b7d4b9eee9">
<head>
  <meta charset="utf-8">
  <title>Fazer proposta</title>
  <meta content="Fazer proposta" property="og:title">
  <meta content="Fazer proposta" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="../../../../css/normalize.css" rel="stylesheet" type="text/css">
  <link href="../../../../css/components.css" rel="stylesheet" type="text/css">
  <link href="../../../../css/fiinika-comercial-app.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Inter:300,regular,500,600,700","Barlow:100,200,300,regular,500,600,700,800,900"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="../../../../images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="../../../../images/webclip.png" rel="apple-touch-icon">
  

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.1/dist/sweetalert2.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.1/dist/sweetalert2.min.js"></script>
  
</head>
<style>
  /* Estilização básica do checkbox */
  .checkbox-wrapper {
    display: flex;
    align-items: center;
  }

  input[type="checkbox"] {
    display: none; /* Esconde o checkbox padrão */
  }

  /* Estilo do checkbox personalizado */
  .custom-checkbox {
    width: 16px;
    height: 16px;
    border: 2px solid gray;
    border-radius: 3px;
    margin-right: 8px;
    position: relative;
    cursor: pointer;
  }

  /* Efeito ao marcar o checkbox */
  input[type="checkbox"]:checked + .custom-checkbox::after {
    content: "";
    position: absolute;
    width: 8px;
    height: 8px;
    background-color: gray;
    top: 3px;
    left: 3px;
    border-radius: 2px;
  }
</style>


<body>
  <div class="mother-div">
    <div class="html-embed w-embed"></div>
    <div class="close-flyout"></div>
    <div class="page-content-wrapper">
    <div th:insert="/fragments/menuAdmin :: menuAdmin"></div>     
      <div class="content">
        <section class="criar-page-section container">
          <div th:each="p:${td}" class="container">
            <div class="top-section-navigation">
              <a href="javascript:history.back()" class="seta-para-tras w-inline-block">
                <div class="text-block-129">q</div>
              </a>
              <div class="titulo">
                <div class="text-block-130">#[[${p[0]}]] - [[${#dates.format(p[2], 'dd/MM/yyyy')}]]<br></div>
              </div>
            </div>
                     <div class="div-block-159">
              <div class="linesman">
                <div class="status-content-wrapper">
                  <div  class="status-circles-wrapper">
                    <div th:if="${p[1] =='Pendente'|| p[1] =='Propostas'}" class="project-state done">
                      <div class="material-icons checker">r</div>
                    </div>
                     <div  th:if="${p[1] =='Cancelado'}" class="project-state in-progress cancelado">
                      <div class="material-icons checker">p</div>
                    </div>
                    
                  </div>
                  <div class="center-text confirmed">
                    <div>Pedido</div>
                  </div>
                </div>
                <div class="status-line">
                  <div class="in-progress-line"></div>
                </div>
                <div class="status-content-wrapper">
                  <div class="status-circles-wrapper">
                    <div  th:if="${p[1] =='Pago'|| p[1] =='Propostas'}"  class="project-state done">
                      <div  class="material-icons checker">r</div>
                    </div>
                    <div class="project-state in-progress"></div>
                  </div>
                  <div class="center-text confirmed">
                    <div>Propostas</div>
                  </div>
                </div>
                <div class="status-line">
                  <div class="confirmed-line hidden"></div>
                  <div class="in-progress-line"></div>
                </div>
                <div class="status-content-wrapper">
                  <div class="status-circles-wrapper">
                    <div th:if="${p[1] =='Pago'|| p[1] =='Entregue'}" class="project-state done ">
                      <div class="material-icons checker">done</div>
                    </div>
                    <div    class="project-state in-progress ">
                     
                    </div>
                    <div    class="project-state in-progress cancelado">
                      <div class="material-icons checker">p</div>
                    </div>
                  </div>
                  <div class="center-text">
                    <div>Pagamento</div>
                  </div>
                </div>
                <div class="status-line">
                  <div class="confirmed-line hidden"></div>
                  <div class="in-progress-line"></div>
                </div>
                <div class="status-content-wrapper">
                  <div class="status-circles-wrapper">
                    <div class="project-state done hidden">
                      <div class="material-icons checker">done</div>
                    </div>
                    <div class="project-state in-progress"></div>
                  </div>
                  <div class="center-text">
                    <div>Entregas</div>
                  </div>
                </div>
                <div class="status-line">
                  <div class="confirmed-line hidden"></div>
                  <div class="in-progress-line"></div>
                </div>
                <div class="status-content-wrapper">
                  <div class="status-circles-wrapper">
                    <div class="project-state done hidden">
                      <div class="material-icons checker">done</div>
                    </div>
                    <div class="project-state in-progress"></div>
                  </div>
                  <div class="center-text">
                    <div>Concluído</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="div-block-160">
              <div class="div-block-161">
                <div class="text-block-143">Sectores selecionados</div>
                <div th:each="s:${sectores}" class="div-block-163">
                  <div th:text="${s[1]}" >Nome do sector selecionado</div>
                </div>
                
              </div>
              <div class="div-block-162">
                <div class="text-block-143">Detalhes do Pedido</div>
                <p class="paragraph-2" th:utext="${p[5]}">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique. Duis cursus, mi quis viverra ornare, eros dolor interdum nulla, ut commodo diam libero vitae erat. Aenean faucibus nibh et justo cursus id rutrum lorem imperdiet. Nunc ut sem vitae risus tristique posuere.<br><br>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique. Duis cursus, mi quis viverra ornare, eros dolor interdum nulla, ut commodo diam libero vitae erat. Aenean faucibus nibh et justo cursus id rutrum lorem imperdiet. Nunc ut sem vitae risus tristique posuere.</p>
                <div class="w-layout-grid grid-19">
                  <div id="w-node-a480b819-b51c-db9a-806a-4c786a163dd8-9754185d">
                    <div class="text-block-189">Início do concurso</div>
                    <div>[[${#dates.format(p[3], 'dd/MM/yyyy')}]]</div>
                  </div>
                  <div id="w-node-a480b819-b51c-db9a-806a-4c786a163ddd-9754185d">
                    <div class="text-block-189">Fim do concurso</div>
                    <div>[[${#dates.format(p[4], 'dd/MM/yyyy')}]]</div>
                  </div>
                  <div id="w-node-a480b819-b51c-db9a-806a-4c786a163dd8-9754185d">
                    <div class="text-block-189">Empresa</div>
                    <div>[[${p[6]}]]</div>
                  </div>
                   <div id="w-node-a480b819-b51c-db9a-806a-4c786a163dd8-9754185d">
                    <div class="text-block-189">Endereço</div>
                    <div>[[${p[7]}]]</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="fazer-proposta-div">
              <div class="w-form">
                <form th:action="'/proposta/'+${idconcurso}" id="email-form" name="email-form" data-name="Email Form" method="POST" data-wf-page-id="669073fb64c37aed5792802d" data-wf-element-id="a560d155-4d48-7a98-a87e-2d597e7c6bd1">
                  <div class="invoice-items">
                    <div>
                    <input th:value="${idconcurso}" type="hidden" id="idconcurs" >
                    <input th:value="${idEmpresa}" type="hidden"  name="empresaPropostaId" >
                      <div class="text-block-143">Faça a sua proposta</div>
                    </div>
                    <div class="form-section-wrapper hidden">
                      <h2 class="table-header">Itens</h2>
                    </div>
                    <div class="items-table">
                      <div class="table-row cell-label-wrapper invoice-items-lable _2">
                        <div class="table-row-content">
                          <div class="cell-label _30">
                            <div class="table-cell-text">Categoria</div>
                          </div>
                          <div class="cell-label _30">
                            <div class="table-cell-text">Produto/Serviço</div>
                          </div>
                          <div class="cell-label _15">
                            <div class="table-cell-text">Preço un.</div>
                          </div>
                          <div class="cell-label _15 qtd">
                            <div class="table-cell-text">Qtd.</div>
                          </div>
                          <div class="cell-label _15">
                            <div class="table-cell-text">Total líquido</div>
                          </div>
                        </div>
                        <div class="item-action filler"></div>
                      </div>
                      <div id="items_table" class="linhas">                  
                  </div>
                
                
                    </div>
                    <div class="item-button-wrapper item">
                      <a id="addRow" href="#" class="add-item-mobile main-text-button w-inline-block">
                        <div class="icon quick-action _7">
                          <div class="main-font-icon _86">s</div>
                          <div class="button-text quick-action-text">Adicionar um item</div>
                        </div>
                        
                      </a>
                    </div>
                     <label class="w-checkbox checkbox-field-3">
                      
                      <input  type="checkbox"      name="checkbox-2"  data-name="Checkbox 2" class="w-checkbox-input checkbox-3">
                      <span class="checkbox-label-2 w-form-label" for="checkbox-2">Checkbox</span></label>
                    
                    <div class="item-button-wrapper item">
                    
                     <a  onclick="entrega()"  href="#" class="add-item-mobile main-text-button w-inline-block">
                        <div class="icon quick-action _7">
                        
                           <div class="checkbox-wrapper">
        <input  type="checkbox" id="entrega-checkbox">
        <div class="custom-checkbox"></div>
        <label for="entrega-checkbox">
         
          <div id="ent" class="button-text quick-action-text" style="color: gray;">Adicionar entrega</div>
        </label>
      </div>
              </div>              
                      </a>
                    </div>
                    
                  </div>
                  <div class="summery-section">
<!--                     <div class="summery"> -->
<!--                       <div class="summery-item"> -->
<!--                         <div>Subtotal</div> -->
<!--                         <div><span class="summery-currency">Kz</span><span id="sp_total">0,00</span></div> -->
<!--                         <input type="hidden" name="total" value="0.0" id="total" required readonly> -->
<!--                       </div> -->
<!--                       <div class="summery-item"> -->
<!--                         <div>IVA (14.7%)</div> -->
<!--                         <div><span class="summery-currency">Kz</span><span id="sp_imposto_">0,00</span></div> -->
<!--                          <input type="hidden" name="imposto_" id="imposto_" value="0.0" required readonly> -->
<!--                       </div> -->
<!--                       <div class="summery-item total"> -->
<!--                         <div class="total-text">Total</div> -->
<!--                         <div><span class="summery-currency">Kz</span><span id="sp_total_final">0,00</span></div> -->
<!--                          <input type="hidden"  name="total_final" value="0.0" id="total_final" required readonly> -->
<!--                       </div> -->
<!--                     </div> -->
                    <div>
                      <div class="create-div _200">
                        <button type="submit" class="button main w-button">Enviar proposta</button>
                      </div>
                    </div>
                  </div>
                </form>
                <div class="w-form-done">
                  <div>Thank you! Your submission has been received!</div>
                </div>
                <div class="w-form-fail">
                  <div>Oops! Something went wrong while submitting the form.</div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=667ada12e2b008b7d4b9eee9" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="../../../../js/fiinika-comercial-app.js" type="text/javascript"></script>
  <script th:inline="javascript">
  
  n_row = 0,n_row_aux = 1, array_linha = []
  var opt='';
  
  /*<![CDATA[*/				  
	var cat = [[${categorias}]];
	var opt='';
 
/*]]>*/

//alert("Mechaque Maluco");



function entrega(){
	$("#ent").text("Remover entrega");
}


 $(document).ready(function() {
	    $('form').submit(function(event) {
	        event.preventDefault(); // Evita que o formulário seja enviado normalmente
			
			
			//alert(a);
	        const loadingSwal = Swal.fire({
	            title: "Aguarde...",
	            didOpen: () => {
	                Swal.showLoading()
	            },
	        });

	        // Crie um objeto FormData para o formulário
	        const formData = new FormData(this);

	        // Envie os dados via AJAX usando FormData
	        const url = "/proposta/"+$("#idconcurs").val();
	        $.ajax({
	            type: "POST",
	            url: url,
	            data: formData,
	            processData: false, // Não processar o FormData (já está em um formato adequado para envio)
	            contentType: false, // Não definir o tipo de conteúdo (o navegador irá definir como 'multipart/form-data')
	            success: function(data) {
	                // Esconda a animação de carregamento
	                loadingSwal.close();

	                // Lógica para manipular a resposta do servidor
	                if (data === "logout") {
	                    Swal.fire({
	                        title: "Sessão expirada",
	                        text: "",
	                        icon: "info"
	                    });
	                } 
	                else if (data === "jafez") {
	                    Swal.fire({
	                        title: "Já efectuou uma proposta para este pedido!!",
	                        text: "",
	                        icon: "info"
	                    });
	                } else {
	                    Swal.fire({
	                        title: "Proposta Enviada",
	                        text: "",
	                        timer: 2500,
	                        icon: "success"
	                    }).then(()=>{window.location.href = "/fiinika/procurement/pedidos-externos/minhas-propostas-historico";})
	                      }
	            },
	            error: function(xhr, textStatus, errorThrown) {
	                // Esconda a animação de carregamento
	                loadingSwal.close();

	                // Mostre a mensagem de erro
	                Swal.fire({
	                    title: "Erro!", 
	                    text: xhr.responseText,
	                    icon: "error"
	                });
	            }
	        });
	    });
	});





$.each(cat,function(index, element) {
// console.log(index + ' : ' + element.id_categoria);
opt+='<option value="'+element.idCategoria+'" >'+element.nomeCategoria+'</option>';
});
  
  
  
  
  
  
  
  
  $('#addRow').on("click", function () {
	    addItem();
	});

 linha = 0;
function addItem() {
	   array_linha[n_row] = linha+1
	   linha++;n_row++;
	   var itemRow =       
	              '<div id="div'+linha+'" class="table-row invoice-item">'+
	                    '<div class="item-number">'+
	                      '<div class="pagination-description">'+linha+'</div>'+
	                    '</div>'+
	                    
	                    '<input type="hidden"  name="ref_cat" placeholder="#92482" id="ref'+linha+'">'+
	                    
	                    '<div class="table-row-content in-items">'+
	                      '<div class="item-table-cell _30">'+
	                      '<label for="name" class="form-field-lable show-on-mobile">Categoria</label>'+
	                        '<div class="ki">'+
	                        '<select onclick="Categ('+linha+')" required id="id_categoria'+linha+'"    name="id_categoria" data-name="Field 3" class="select-field-copy w-select">'+
	                             '<option value="">Categoria...</option>'+
	                              opt+
	                          '</select>'+	                          
	                        '</div>'+
	                      '</div>'+
	                      //--Produto
	                      '<div class="item-table-cell _30">'+
	                      '<label for="name" class="form-field-lable show-on-mobile">Produto</label>'+
	                        '<div class="ki">'+
	                        '<select onclick="Prod('+linha+')" id="id_produto'+linha+'" name="id_produto" data-name="Field 3" class="select-field-copy w-select produtosss">'+
	                          '</select>'+	                         
	                        '</div>'+
	                      '</div>'+
	                      //----- Preco
	                      '<div class="item-cells-wrapper">'+
	                        '<div class="item-table-cell _15 prc-unit">'+
	                        '<label for="name" class="form-field-lable show-on-mobile">Preço un.</label>'+
	                          '<div class="text-field-inner-wrapper">'+
	                          '<input  type="text"  onclick="Preco('+linha+')"    name="preco" id="preco'+linha+'" class="item-text-field with-currency w-input precosss" maxlength="256"  data-name="subtotal" placeholder="0,00" >'+
	                          '<label for="name" class="inside-form-field-lable form-field-currency">Kz</label>'+
	                          '</div>'+
	                        '</div>'+
	                        //--- quantidade
	                        '<div class="item-table-cell _15 qtd">'+
	                        '<label for="name" class="form-field-lable show-on-mobile">Qtd.</label>'+
	                          '<div class="plus-minus-wrap">'+
	                            '<a href="#" onclick="Menos('+linha+')" class="action-button plus-minus w-inline-block">'+
	                              '<div class="icon plus-minus">'+
	                                '<div class="main-font-icon _5">-</div>'+
	                              '</div>'+
	                            '</a>'+
	                            
	                            '<input  type="text"  onclick="Qtd('+linha+')"  id="qtd'+linha+'" class="item-text-field qtd w-input qtds" maxlength="256" name="qtd1" data-name="Quantidade" placeholder="0"  >'+
	                            
	                            '<a href="#"  onclick="Mais('+linha+')" class="action-button plus-minus w-inline-block">'+
	                              '<div class="icon plus-minus">'+
	                                '<div class="main-font-icon _5">+</div>'+
	                              '</div>'+
	                            '</a>'+
	                          '</div>'+
	                        '</div>'+
	                      '</div>'+
	                      
	                      '<input  type="hidden"  maxlength="256" id="taxa'+linha+'" name="taxa_prod" class="taxas">'+
	                      '<input  type="hidden"  maxlength="256" id="tipo_servico'+linha+'" name="tipo_prod" class="servicos">'+
	                    
	                       //---- Subtotal
	                      '<div class="item-table-cell _15 total-item">'+
	                      '<label for="name" class="form-field-lable show-on-mobile">Total.</label>'+
	                        '<div class="text-field-inner-wrapper">'+
	                        '<input readonly type="text" id="subtotal'+linha+'" name="subtotal1"   class="item-text-field with-currency liquido w-input sbt" maxlength="256"  data-name="subtotal" placeholder="0,00" >'+
	                        '<label for="name-2" class="inside-form-field-lable form-field-currency">Kz</label>'+
	                        '</div>'+
	                      '</div>'+
	                    '</div>'+
	                    '<div class="item-action">'+
	                     '<a onclick="Rem('+linha+')"  id="'+linha+'" href="#" class="action-button delete-item w-inline-block">'+
	                        '<div class="icon">'+
	                          '<div class="main-font-icon">v</div>'+
	                       '</div>'+
	                    '</a>'+
	                    ' <a href="#" onclick="Rem('+linha+')" class="link-2">Apagar</a>'+
	                    '</div>'+
	                  '</div>';	                  
	               
	                  
	    $("#items_table").append(itemRow);
	    $("#qtdLinhaMain").val(linha);
	    console.log(linha+"--"+n_row)
	    
// 	    document.querySelectorAll('.precosss').forEach(function(element) {
// 	        element.addEventListener('input', moeda);
// 	    });

	}

	addItem();
	
	function AddAux(){
		
		
	      
	     if(n_row_aux > 1){
	    	 addItem();
	     }
	        	
	     n_row_aux++;
			
	    
		}
  
	function Rem(id){
		
	//$('#div'+id).remove();
		
	
		var qtd_inicial=parseInt($("#qtdLinhaMain").val());
        var total=RemovePV($("#total_final").val());	          
        var sub= $("#subtotal"+id).val();
	
		if(qtd_inicial!=1){
			if(sub!=0){				
			total=total-RemovePV(sub);
			}
			console.log(qtd_inicial+" aqui ");
			$("#div"+id).remove();
			$("#divM"+id).remove();
		    $("#qtdLinhaMain").val(qtd_inicial-1);	
		   Total_Imposto()	
		   n_row--
		   // DescontoAux()			       
		//	n_linha--;
			}
	
	
	
		}
	
	
	function Categ(id){         
  		
			 $('#id_categoria'+id).change(
          function() {
       	   val_id = $(this).val()
				 $.getJSON("/ajax/produtos", {
             id_categoria : val_id,
             ajax : 'true'
         	}, function(data) {  
	            var i=0;
             var html = '';
             var len = data.length;
       if(len>0){
             for ( i=0; i < len; i++) {
	                if(i==0){ 
	                  
	                  t =  data[i][4]*(data[i][6]*1/100)	     // Para a taxa do produto se é com iva ou sem iva		            
	                  t =  parseFloat(t) + parseFloat(data[i][4])        
	                        	
		              var prec= Dec(data[i][4]); // Adiciona casas decimais e milesimas
                   var ref=data[i][7];
		              $("#preco"+id).val(prec);
					  $("#qtd"+id).val(1);
					  $('#taxa'+id).val(data[i][6]);  					
		              $("#subtotal"+id).val(Dec(t));
                 $("#ref"+id).val(ref);
                 $('#tipo_servico'+id).val(data[i][8]);                     
                   
		          }
                 html += '<option value="' + data[i][0] + '">'
                         + data[i][3] + '</option>';
                  
             }
             html += '</option>';
             $('#id_produto'+id).html(html);             
           
				Total_Imposto()
				//DescontoAux()
             }else{
	                  $("#preco"+id).val("");
					  $("#qtd"+id).val("");
		              $("#subtotal"+id).val("");
                   $("#ref"+id).val("");
                   $('#id_produto'+id).html(html);
				}
  });
	              
});
			 
	}		 
	
	
	function Dec(valor){
		
		var val= new Number(valor);
		var decimal=val.toLocaleString("pt-BR",{
			minimumFractionDigits:2,
			maximumFractionDigits:2});
			return decimal;
	
}
	
	function Prod(id){	
 		
     	$('#id_produto'+id).change(
          function() {
        	  val_id = $(this).val();	
              $.getJSON("/ajax/produtos_data", {
                  id_produto : val_id,
                  ajax : 'true'
              }, function(data) {     
                  $('#preco'+id).val(Dec(data.preco_produto));      
                  
                   t   =  data.preco_produto *(data.taxa_prod*1/100)	     // Para a taxa do produto se é com iva ou sem iva		            
  	               t =  parseFloat(t) + parseFloat(data.preco_produto) 
                           
                  $('#subtotal'+id).val(Dec(t*$('#qtd'+id).val()));
                  $('#taxa'+id).val(data.taxa_prod); 
                  $('#tipo_servico'+id).val(data.tipo_produto); 
                 
              
                
  				
  				Total_Imposto()
  				//DescontoAux()
             });
          });
  }
	
	
	function Total_Imposto(){


	  	var precos = $(".precosss").map(function() {
	  	   return $(this).val();
	  	}).get();
	  	
	  	var qtds = $(".qtds").map(function() {
	  	   return $(this).val();
	  	}).get();
	  	
	  	var taxas = $(".taxas").map(function() {
	  	   return $(this).val();
	  	}).get();
	  	
	  	var sbts = $(".sbt").map(function() {
	  	   return $(this).val();
	  	}).get();
	  	
	  	
	  	var servs = $(".servicos").map(function() {
	   	   return $(this).val();
	   	}).get();
	  	
	  	linhas = precos.length;



	    total_imposto = 0,total=0,subtotal=0,total_retido=0,subtotal_incidir_ret=0;
	  	for(i=0;i<linhas;i++){
	  		
	  		total_imposto = total_imposto + (parseFloat(RemovePV(precos[i])) * qtds[i]) * ( (taxas[i]*1)/100);
	  		
	  	    total=total+parseFloat(RemovePV(sbts[i]));
	  	  
	  	    
	  	    subtotal = subtotal + (parseFloat(RemovePV(precos[i])) * qtds[i]);
	  	    if(servs[i] == "Serviço 6.5"){
	  	    	 total_retido = total_retido + (parseFloat(RemovePV(precos[i])) * qtds[i]) * ( (6.5*1)/100);
	  	    	  subtotal_incidir_ret = subtotal_incidir_ret + (parseFloat(RemovePV(precos[i])) * qtds[i]);
	  	    }
	  	    
	  	    // Para os items em Mobile
	  	}
	  	
	  	 total=total-total_retido
	  	
	  	$("#imposto_").val(Dec(total_imposto));
	  	$("#total").val(Dec(subtotal));
		// Verificar o desconto aqui
	  	//desconto = RemovePV($("#total").val())*(RemovePV($("#desconto").val())/100)
	  	// ou 
	  	//desconto = total*(RemovePV($("#desconto").val())/100)
	  	
	  	//$("#desconto_").val(Dec(desconto))
	  	//$("#valor_desconto").val(Dec(desconto))  	
	  	//total=total-desconto;
		//====== XXX =====
		$("#imposto_retido_").val(total_retido)
		
		
		
	  	Total(total)
	  	
	  	
	  }
	
	 function Total(valor){
		  	$("#total_final").val(Dec(valor));
		  	$("#total_finalF").val(valor);
		  	//----------Sset Span
			$("#sp_total_final").text($("#total_final").val());
			$("#sp_imposto_").text($("#imposto_").val());
			$("#sp_total").text($("#total").val());
			$("#sp_desconto").text($("#desconto_").val());
			$("#sp_imposto_retido_").text(Dec($("#imposto_retido_").val()));
			
		  	
		  	
		  	
		  	
		  }
	
	function Mais(id){
		  console.log(id)
	       	    $('#qtd'+id).val(parseInt($('#qtd'+id).val())+1)	  	
	                var sub = $('#qtd'+id).val()*RemovePV($('#preco'+id).val());	                  
	                t   =  sub *($("#taxa"+id).val()*1/100)	     // Para a taxa do produto se é com iva ou sem iva		            
	 	             sub =  parseFloat(t) + parseFloat(sub) 
	                 
	                 $('#subtotal'+id).val(Dec(sub));
	 				
	 				Total_Imposto()	  	
		          
		  }
	  
	  
	  function Menos(id){
		  
		  if($('#qtd'+id).val()>1){
			  
			  $('#qtd'+id).val(parseInt($('#qtd'+id).val())-1)	  	
	          var sub = $('#qtd'+id).val()*RemovePV($('#preco'+id).val());	                  
	          t   =  sub *($("#taxa"+id).val()*1/100)	     // Para a taxa do produto se é com iva ou sem iva		            
	            sub =  parseFloat(t) + parseFloat(sub) 
	           
	           $('#subtotal'+id).val(Dec(sub));
				
			   Total_Imposto()	
		  }
	 	     	
	        
	}
	  
	  function Prod(id){	
   		
	     	$('#id_produto'+id).change(
	          function() {
	        	  val_id = $(this).val();	
	              $.getJSON("/ajax/produtos_data", {
	                  id_produto : val_id,
	                  ajax : 'true'
	              }, function(data) {     
	                  $('#preco'+id).val(Dec(data.preco_produto));      
	                  
	                   t   =  data.preco_produto *(data.taxa_prod*1/100)	     // Para a taxa do produto se é com iva ou sem iva		            
	  	               t =  parseFloat(t) + parseFloat(data.preco_produto) 
	                           
	                  $('#subtotal'+id).val(Dec(t*$('#qtd'+id).val()));
	                  $('#taxa'+id).val(data.taxa_prod); 
	                  $('#tipo_servico'+id).val(data.tipo_produto); 
	                 
	              
	                
	  				
	  				Total_Imposto()
	  				//DescontoAux()
	             });
	          });
	  }

	
	  function RemovePV(str_valor){
			 var imp =  str_valor.replaceAll(".", "")
		     return  imp.replace(",",".")       
		}
	  
	  function Qtd(id){
	  	 $('#qtd'+id).keyup(function() {  	  
	                  var sub = $(this).val()*RemovePV($('#preco'+id).val());
	                  
	                   t   =  sub *($("#taxa"+id).val()*1/100)	     // Para a taxa do produto se é com iva ou sem iva		            
	  	             sub =  parseFloat(t) + parseFloat(sub) 
	                  
	                  $('#subtotal'+id).val(Dec(sub));
	  				
	  				Total_Imposto()
	  				//DescontoAux()
	                           
	          });
	  }
	  
	  function Preco(id){
		  	 $('#preco'+id).keyup(function() {  	  
				  		 var sub = $('#qtd'+id).val()*RemovePV($('#preco'+id).val());	                  
				         t   =  sub *($("#taxa"+id).val()*1/100)	     // Para a taxa do produto se é com iva ou sem iva		            
				           sub =  parseFloat(t) + parseFloat(sub) 
		                  $('#subtotal'+id).val(Dec(sub));
		  				
		  			    Total_Imposto()
		  				//DescontoAux()
		                           
		          });
		  }

		  function Subtotal(total){

		      $("#total").val(Dec(total));
		      var imp= total*(impost/100)
		      $("#imposto_").val(Dec(imp))  
		      Total(total)
		  }
	  
  </script>
</body>
</html>