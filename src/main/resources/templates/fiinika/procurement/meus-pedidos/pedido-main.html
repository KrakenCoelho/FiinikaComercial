<!DOCTYPE html><!--  Last Published: Fri Jul 12 2024 13:58:39 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="668fad56447af06e8ae1153b" data-wf-site="667ada12e2b008b7d4b9eee9">
<head>
  <meta charset="utf-8">
  <title>Pedido main</title>
  <meta content="Pedido main" property="og:title">
  <meta content="Pedido main" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="../../../../css/normalize.css" rel="stylesheet" type="text/css">
  <link href="../../../../css/components.css" rel="stylesheet" type="text/css">
  <link href="../../../../css/fiinika-comercial-app.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Inter:300,regular,500,600,700","Barlow:100,200,300,regular,500,600,700,800,900"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="../../../../images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="../../../../images/webclip.png" rel="apple-touch-icon">
  
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.1/dist/sweetalert2.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.1/dist/sweetalert2.min.js"></script>
  
  
</head>
<style>
 

  .row {
    display: flex;
    flex-direction: row;
    align-items: center; /* Opcional: Alinha verticalmente ao centro */
    justify-content: space-between; /* Opcional: Espaço entre os itens */
    margin-bottom: 10px;
  }

 
</style>
<body>
  <div class="mother-div">
    <div class="html-embed w-embed"></div>
    <div class="close-flyout"></div>
    <div class="page-content-wrapper">
  		<div th:insert="/fragments/menuAdmin :: menuAdmin"></div>  
      
       <div class="content">
        <section class="criar-page-section container">
          <div th:each="p:${td}" class="container">
            <div class="top-section-navigation">
              <a href="javascript:history.back()" class="seta-para-tras w-inline-block">
                <div class="text-block-129">q</div>
              </a>
              <div class="titulo">
                <div  class="text-block-130">#[[${p.IdPedido}]] - [[${#dates.format(p.dataCriacao, 'dd/MM/yyyy')}]]<br></div>
              </div>
            </div>
            <div class="div-block-159">
              <div class="linesman">
                <div class="status-content-wrapper">
                  <div  class="status-circles-wrapper">
                    <div th:if="${p.estado !='Cancelado'}" class="project-state done">
                      <div class="material-icons checker">r</div>
                    </div>
                     <div  th:if="${p.estado =='Cancelado'}" class="project-state in-progress cancelado">
                      <div class="material-icons checker">p</div>
                    </div>
                    
                  </div>
                  <div class="center-text confirmed">
                    <div>Pedido</div>
                  </div>
                </div>
                <div class="status-line">
                  <div class="in-progress-line"></div>
                </div>
                <div class="status-content-wrapper">
                  <div class="status-circles-wrapper">
                    <div  th:if="${p.estado =='Pago'|| p.estado =='Propostas'}"  class="project-state done">
                      <div  class="material-icons checker">r</div>
                    </div>
                    <div class="project-state in-progress"></div>
                  </div>
                  <div class="center-text confirmed">
                    <div>Propostas</div>
                  </div>
                </div>
                <div class="status-line">
                  <div class="confirmed-line hidden"></div>
                  <div class="in-progress-line"></div>
                </div>
                <div class="status-content-wrapper">
                  <div class="status-circles-wrapper">
                    <div th:if="${p.estado =='Pago'|| p.estado =='Entregue'}" class="project-state done ">
                      <div class="material-icons checker">done</div>
                    </div>
                    <div    class="project-state in-progress ">
                     
                    </div>
                    <div    class="project-state in-progress cancelado">
                      <div class="material-icons checker">p</div>
                    </div>
                  </div>
                  <div class="center-text">
                    <div>Pagamento</div>
                  </div>
                </div>
                <div class="status-line">
                  <div class="confirmed-line hidden"></div>
                  <div class="in-progress-line"></div>
                </div>
                <div class="status-content-wrapper">
                  <div class="status-circles-wrapper">
                    <div class="project-state done hidden">
                      <div class="material-icons checker">done</div>
                    </div>
                    <div class="project-state in-progress"></div>
                  </div>
                  <div class="center-text">
                    <div>Entregas</div>
                  </div>
                </div>
                <div class="status-line">
                  <div class="confirmed-line hidden"></div>
                  <div class="in-progress-line"></div>
                </div>
                <div class="status-content-wrapper">
                  <div class="status-circles-wrapper">
                    <div class="project-state done hidden">
                      <div class="material-icons checker">done</div>
                    </div>
                    <div class="project-state in-progress"></div>
                  </div>
                  <div class="center-text">
                    <div>Concluído</div>
                  </div>
                </div>
              </div>
            </div>
            
            
            <div class="div-block-160">
              <div class="div-block-161">
                <div class="text-block-143">Sectores selecionados</div>
                <div th:each="s:${sectores}" class="div-block-163">
                  <div th:text="${s[1]}" >Nome do sector selecionado</div>
                </div>
                
              </div>
              <div class="div-block-162">
                <div class="text-block-143">Detalhes do Pedido</div>
                <p class="paragraph-2" th:utext="${p.descricao}">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique. Duis cursus, mi quis viverra ornare, eros dolor interdum nulla, ut commodo diam libero vitae erat. Aenean faucibus nibh et justo cursus id rutrum lorem imperdiet. Nunc ut sem vitae risus tristique posuere.<br><br>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique. Duis cursus, mi quis viverra ornare, eros dolor interdum nulla, ut commodo diam libero vitae erat. Aenean faucibus nibh et justo cursus id rutrum lorem imperdiet. Nunc ut sem vitae risus tristique posuere.</p>
                <div class="w-layout-grid grid-19">
                  <div id="w-node-a480b819-b51c-db9a-806a-4c786a163dd8-9754185d">
                    <div class="text-block-189">Início do concurso</div>
                    <div>[[${#dates.format(p.dataInicioConcurso, 'dd/MM/yyyy')}]]</div>
                  </div>
                  <div id="w-node-a480b819-b51c-db9a-806a-4c786a163ddd-9754185d">
                    <div class="text-block-189">Fim do concurso</div>
                    <div>[[${#dates.format(p.dataFechoConcurso, 'dd/MM/yyyy')}]]</div>
                  </div>
                </div>
              </div>
            </div>
            
            <div  class="propostas-wrapper">
              <div class="text-block-143">Propostas de fornecedores</div>
              <div th:each="e:${Emp}"  th:if="${e[1]}=='Pendente'" class="div-block-164">
                <div class="div-block-165">
              
                  <div class="text-block-143 _5">Fornecedor</div>
                  <div class="text-block-145" th:text="${e[2]}">Nome do Fornecedor</div>
                   <div class="text-block-145" th:text="${e[5]}">Nome do Fornecedor</div>
                  <div class="div-block-126">
                    <div th:if="${e[1]}=='Rejeitado'" class="status-wrapper cancelado">
                      <div class="status-text">rejeitado</div>
                    </div>
                    <div th:if="${e[1]}=='Pendente'" class="status-wrapper factura">
                      <div class="status-text">concorrente</div>
                    </div>
                    <div th:if="${e[1]}=='Pago'" class="status-wrapper pago">
                      <div class="status-text">pago</div>
                    </div>
                  </div>
                </div>
               
                 <div class="w-form">
                  <form action="/savepag"  th:id="'form'+${e[3]}" name="email-form" data-name="Email Form" method="get" data-wf-page-id="668fad56447af06e8ae1153b" data-wf-element-id="08a9faa5-2d57-e874-1e4b-fc95c6716db6">
                     <input th:value="${e[3]}" name="empresa_id" type="hidden"  >
                      <input th:value="${e[0]}" name="proposta_id"type="hidden"  >
                       <input th:value="${e[4]}" name="pedido_id" type="hidden" >
                    <div th:each="a:${artigos}"  th:if="${a[9]==e[3]}" class="product-wrap">
                      <div class="check-imagem-and-name">
                      <label class="w-checkbox checkbox-field-3">
                      
                      <input  type="checkbox"  th:data-a="${a[8]}"  th:data-b="${e[3]}"  onclick="mos(this.dataset.a,this.dataset.b)"  name="checkbox-2" th:id="'checkbox'+${a[8]}+''+${e[3]}" data-name="Checkbox 2" class="w-checkbox-input checkbox-3">
                      <span class="checkbox-label-2 w-form-label" for="checkbox-2">Checkbox</span></label>
                        <div class="div-block-166">
                        <img  th:src="@{${'/imgs/produtos/' + a[1]}}" loading="lazy" sizes="(max-width: 479px) 17vw, (max-width: 767px) 13vw, (max-width: 991px) 10vw, 100px"  alt="" class="image"></div>
                        <div>
                          <div class="text-block-146">Artigo</div>
                          <div>[[${a[2]}]]</div>
                        </div>
                      </div>
                      <div class="product-price-quantity-and-other">
                        <div class="w-layout-grid grid-16">
                          <div id="w-node-d96d065c-65de-134f-93bc-22796c7c9b61-8ae1153b">
                            <div class="text-block-146">Preço Unitário</div>
                            <div>KZ  [[${a[3]}]] </div>
                            <input th:value="${a[3]}" th:id="'p'+${a[8]}" type="hidden" >
                            
                            <input th:value="(${a[6]}/100)" th:id="'imp'+${a[8]}" type="hidden" >
                            <input  th:id="'impo'+${a[8]}+''+${e[3]}" th:class="'impo'+${e[3]}" type="hidden" >

                            <input th:value="${a[4]}" th:id="'st'+${a[8]}"  type="hidden">
                            <input  th:id="'sb'+${a[8]}+''+${e[3]}" type="hidden" th:class="'sbt'+${e[3]}" name="globo">
                            
                          	 <input th:id="'ip'+${a[8]}" name="prodIds"  type="hidden">
                          </div>
                          <div id="w-node-d96d065c-65de-134f-93bc-22796c7c9b66-8ae1153b">
                            <div class="text-block-146">Quantidade em stock</div>
                            <div>[[${a[4]}]]</div>
                          </div>
                          <div th:id="'qtdx'+${a[8]}" style="display:none">
                            <div class="text-block-146">Quantas unidades deseja?</div>
                            <input th:data-a="${a[8]}"  th:data-b="${e[3]}" min="0" onkeyup="sub(this.dataset.a,this.dataset.b)"  onchange="sub(this.dataset.a,this.dataset.b)" th:id="'qtd'+${a[8]}"  class="text-field-2 w-input" maxlength="256"   placeholder="Ex: 01" type="number" name="qtd" >
                          </div>
                          <div th:id="'rx'+${a[8]}" style="display:none"> 
                            <div class="text-block-146">Subtotal</div>
                            <div th:id="'r'+${a[8]}" >KZ 0,00</div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="w-clearfix">
                      <div class="div-block-167">
                        <div class="div-block-168" style="display:block; flex-direction: column;"  >
                        
                       		<div class="row">
                          <div class="text-block-147" style="font-weight: normal;">Subtotal:</div>
                          <div  th:id="'total'+${e[3]}" class="text-block-148">KZ 0,00</div>
                         <input th:id="'totall'+${e[3]}" type="hidden" name="sb" >
                        </div>
                       		<div class="row">
                          <div class="text-block-147" style="font-weight: normal;">Imposto:</div>
                          <div  th:id="'impp'+${e[3]}" class="text-block-148">KZ 0,00</div>
                         <input th:id="'imppo'+${e[3]}" type="hidden" name="imp" >
                       	  </div>
                       	 
                       	 <div class="row">
                       	 <div class="text-block-147" style="font-weight: normal;">Taxa de serviço:</div>
                          <div  th:id="'tx'+${e[3]}" class="text-block-148">KZ 0,00</div>
                         <input th:id="'txx'+${e[3]}" type="hidden" name="taxa_servico" >
                          </div>
                         
                         <div class="row">
                         <div class="text-block-147">TOTAL:</div>
                          <div  th:id="'i'+${e[3]}" class="text-block-148">KZ 0,00</div>
                         <input th:id="'im'+${e[3]}" type="hidden" name="valor" >
                          </div>
                          
                        </div>
                        	
                        <div>
                        <input th:id="'stx' +${e[3]}" name="valor_sem_taxa" type="hidden" >
                          <div class="w-layout-grid grid-17">
                            <div id="w-node-_38d3c1e0-e451-6d84-131a-82cac97ab89d-8ae1153b" class="create-div">
                              <a th:data-b="${e[3]}"  onclick="comprar(this.dataset.b);" href="#" class="button main w-button">Pagar</a>
                               <input th:id="'submit'+${e[3]}" type="submit" style="display:none;" value="COMPRAR"/>
                            </div>
                            <div id="w-node-ad47b9e7-7c3c-609e-1b41-60c16637942c-8ae1153b" class="create-div">
                              <a th:data-b="${e[0]}"  onclick="rejeitar(this.dataset.b);" href="#" class="button main cinza w-button">Rejeitado</a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </form>
                  <div class="w-form-done">
                    <div>Thank you! Your submission has been received!</div>
                  </div>
                  <div class="w-form-fail" th:id="'er'+${e[3]}">
                    <div>Selececione um producto!!</div>
                  </div>
                </div>
              </div>
              <div  th:each="e:${Emp}"  th:if="${e[1]}=='Pago'" class="div-block-164">
                <div class="div-block-165">
                  <div class="text-block-143 _5">Fornecedor</div>
                  <div class="text-block-145"  th:text="${e[2]}" >Nome do Fornecedor</div>
                   <div class="text-block-145" th:text="${e[5]}">Nome do Fornecedor</div>
                  <div class="div-block-126">
                    <div class="status-wrapper pago">
                      <div class="status-text">pago</div>
                    </div>
                  </div>
                </div>
                <div class="w-form">
                  <form id="email-form" name="email-form" data-name="Email Form" method="get" data-wf-page-id="668fad56447af06e8ae1153b" data-wf-element-id="28450a23-50b5-c86c-cac8-a33df9b0eed0">
                    <div th:each="a:${pagos}"  th:if="${a[9]==e[3]}" class="product-wrap">
                      <div class="check-imagem-and-name">
                        <div class="div-block-166">
                        <img  th:src="@{${'/imgs/produtos/' + a[1]}}" loading="lazy" sizes="(max-width: 479px) 17vw, (max-width: 767px) 15vw, (max-width: 991px) 10vw, 100px"  alt="" class="image"></div>
                        <div>
                          <div class="text-block-146">Artigo</div>
                          <div>[[${a[2]}]]</div>
                        </div>
                      </div>
                      <div class="product-price-quantity-and-other">
                        <div class="w-layout-grid grid-16">
                          <div id="w-node-_28450a23-50b5-c86c-cac8-a33df9b0eee0-8ae1153b">
                            <div class="text-block-146">Preço Unitário</div>
                            <div>KZ [[${a[3]}]]</div>
                          </div>
                          <div id="w-node-_28450a23-50b5-c86c-cac8-a33df9b0eee5-8ae1153b">
                            <div class="text-block-146">Quantidade em stock</div>
                            <div>[[${a[4]}]]</div>
                          </div>
                          <div id="w-node-_28450a23-50b5-c86c-cac8-a33df9b0eeea-8ae1153b">
                            <div class="text-block-146">Quantas unidades deseja?</div>
                            <div>[[${a[10]}]]</div>
                          </div>
                          <div id="w-node-_28450a23-50b5-c86c-cac8-a33df9b0eeee-8ae1153b">
                            <div class="text-block-146">Subtotal</div>
                            <div>KZ [[${#numbers.formatDecimal(a[5],3,'POINT',2,'COMMA')}]]</div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="w-clearfix">
                      <div class="div-block-167">
                        <div class="confirmation-box">
                          <div class="text-block-185">Por favor confirme a recepção deste pedido</div>
                          <div class="w-layout-grid grid-17 _5">
                            <div id="w-node-_2bb5dee3-4bca-1951-ee7e-85e62d942b77-8ae1153b" class="create-div">
                              <a href="#" class="button main w-button" th:data-b="${e[0]}" th:data-a="${idpedido}" onclick="confirmar(this.dataset.b,this.dataset.a);">Confirmar</a>
                            </div>
                            <div id="w-node-_2bb5dee3-4bca-1951-ee7e-85e62d942b7a-8ae1153b" class="create-div">
                              <a href="#" class="button main cinza w-button"  th:data-b="${e[0]}"  onclick="negar(this.dataset.b);" >Negar</a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </form>
                  <div class="w-form-done">
                    <div>Thank you! Your submission has been received!</div>
                  </div>
                  <div class="w-form-fail">
                    <div>Oops! Something went wrong while submitting the form.</div>
                  </div>
                </div>
              </div>
              <div  th:each="e:${Emp}"  th:if="${e[1]}=='Entregue'" class="div-block-164">
                <div class="div-block-165">
                  <div class="text-block-143 _5">Fornecedor</div>
                  <div class="text-block-145" th:text="${e[2]}" >Nome do Fornecedor</div>
                   <div class="text-block-145" th:text="${e[5]}" >Nome do Fornecedor</div>
                  <div class="div-block-126">
                    <div class="status-wrapper pago">
                      <div class="status-text">pago</div>
                    </div>
                  </div>
                </div>
                <div class="w-form">
                  <form id="email-form" name="email-form" data-name="Email Form" method="get" data-wf-page-id="668fad56447af06e8ae1153b" data-wf-element-id="fc93e70c-3c6c-ca88-ead1-1123668b425c">
                    <div th:each="a:${pagos}"  th:if="${a[9]==e[3]}" class="product-wrap">
                      <div class="check-imagem-and-name">
                        <div class="div-block-166">
                        <img  th:src="@{${'/imgs/produtos/' + a[1]}}" loading="lazy" sizes="(max-width: 479px) 17vw, (max-width: 767px) 15vw, (max-width: 991px) 10vw, 100px"  alt="" class="image"></div>
                        <div>
                          <div class="text-block-146">Artigo</div>
                          <div>[[${a[2]}]]</div>
                        </div>
                      </div>
                      <div class="product-price-quantity-and-other">
                        <div class="w-layout-grid grid-16">
                          <div id="w-node-fc93e70c-3c6c-ca88-ead1-1123668b426c-8ae1153b">
                            <div class="text-block-146">Preço Unitário</div>
                            <div>KZ [[${a[3]}]]</div>
                          </div>
                          <div id="w-node-fc93e70c-3c6c-ca88-ead1-1123668b4271-8ae1153b">
                            <div class="text-block-146">Quantidade em stock</div>
                            <div>[[${a[4]}]]</div>
                          </div>
                          <div id="w-node-fc93e70c-3c6c-ca88-ead1-1123668b4276-8ae1153b">
                            <div class="text-block-146">Quantas unidades deseja?</div>
                            <div>[[${a[10]}]]</div>
                          </div>
                          <div id="w-node-fc93e70c-3c6c-ca88-ead1-1123668b427b-8ae1153b">
                            <div class="text-block-146">Subtotal</div>
                            <div>KZ [[${#numbers.formatDecimal(a[5],3,'POINT',2,'COMMA')}]]</div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="w-clearfix">
                      <div class="div-block-167">
                        <div class="confirmation-box">
                          <div class="text-block-185 _5">Pedido entregue</div>
                        </div>
                      </div>
                    </div>
                  </form>
                  <div class="w-form-done">
                    <div>Thank you! Your submission has been received!</div>
                  </div>
                  <div class="w-form-fail">
                    <div>Selececione um producto</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    
    </div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=667ada12e2b008b7d4b9eee9" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="../../../../js/fiinika-comercial-app.js" type="text/javascript"></script>
  <script th:inline="javascript">
  
	
  
  function comprar(d){
		if(($("#totall"+d).val())==''  || ($("#totall"+d).val())<=0 ){
			
			 $('#er' + d).show().delay(8000).fadeOut();
		}else{
			$('#submit'+d).click();
			
			  $('#form'+d).submit(function(event) {
			        event.preventDefault(); // Evita que o formulário seja enviado normalmente
					
					
					//alert(a);
			        const loadingSwal = Swal.fire({
			            title: "Aguarde...",
			            didOpen: () => {
			                Swal.showLoading()
			            },
			        });

			        // Crie um objeto FormData para o formulário
			        const formData = new FormData(this);

			        // Envie os dados via AJAX usando FormData
			        const url = "/savepag";
			        $.ajax({
			            type: "POST",
			            url: url,
			            data: formData,
			            processData: false, // Não processar o FormData (já está em um formato adequado para envio)
			            contentType: false, // Não definir o tipo de conteúdo (o navegador irá definir como 'multipart/form-data')
			            success: function(data) {
			                // Esconda a animação de carregamento
			                loadingSwal.close();

			                // Lógica para manipular a resposta do servidor
			                if (data === "index") {
			                    Swal.fire({
			                        title: "Sessão expirada",
			                        text: "",
			                        icon: "info"
			                    });
			                } else {
			                    Swal.fire({
			                        title: "Proposta Enviada",
			                        text: "",
			                        timer: 2500,
			                        icon: "success"
			                    })//.then(()=>{window.location.href = "/fiinika/procurement/pedidos-externos/minhas-propostas-historico";})
			                      }
			            },
			            error: function(xhr, textStatus, errorThrown) {
			                // Esconda a animação de carregamento
			                loadingSwal.close();

			                // Mostre a mensagem de erro
			                Swal.fire({
			                    title: "Erro!", 
			                    text: xhr.responseText,
			                    icon: "error"
			                });
			            }
			        });
			    });
		       }
  }
  
  
 
	    $('form').submit(function(event) {
	        event.preventDefault(); // Evita que o formulário seja enviado normalmente
			
			
			//alert(a);
	        const loadingSwal = Swal.fire({
	            title: "Aguarde...",
	            didOpen: () => {
	                Swal.showLoading()
	            },
	        });

	        // Crie um objeto FormData para o formulário
	        const formData = new FormData(this);

	        // Envie os dados via AJAX usando FormData
	        const url = "/savepag";
	        $.ajax({
	            type: "POST",
	            url: url,
	            data: formData,
	            processData: false, // Não processar o FormData (já está em um formato adequado para envio)
	            contentType: false, // Não definir o tipo de conteúdo (o navegador irá definir como 'multipart/form-data')
	            success: function(data) {
	                // Esconda a animação de carregamento
	                loadingSwal.close();

	                // Lógica para manipular a resposta do servidor
	                if (data === "index") {
	                    Swal.fire({
	                        title: "Sessão expirada",
	                        text: "",
	                        icon: "info"
	                    });
	                } else {
	                    Swal.fire({
	                        title: "Proposta Enviada",
	                        text: "",
	                        timer: 2500,
	                        icon: "success"
	                    }).then(()=>{window.location.href = "/fiinika/procurement/meus-pedidos/pagamento-page---procurement/"+data;})
	                      }
	            },
	            error: function(xhr, textStatus, errorThrown) {
	                // Esconda a animação de carregamento
	                loadingSwal.close();

	                // Mostre a mensagem de erro
	                Swal.fire({
	                    title: "Erro!", 
	                    text: xhr.responseText,
	                    icon: "error"
	                });
	            }
	        });
	    });
	
  
  
  
  
  
  
  function sub(p,d){
	 // alert(param);
	 var preco= RemovePV($('#p'+p).val()); 
	 var taxa= $('#tx'+p).val();
	 var qtd= $('#qtd'+p).val();
	 var st= $('#st'+p).val();
	 var imp= $('#imp'+p).val();
	 var total = 0;
	 var impos = 0;
	 var ed=0;
	 var txs=0;   
	 
	 
	
	 
	 if(parseFloat(qtd)<=parseFloat(st)){
		 if (isNaN(parseFloat(qtd)) || parseFloat(qtd) === 0) {
			    var subtotal = 0 * parseFloat(preco); // multiplicar por 0 é redundante, mas mantém o código mais claro
			    $('#sb' + p + d).val(subtotal);
			    $('#r' + p).text('KZ ' + Dec(subtotal));
			}else{
		 var subtotal= parseFloat(qtd)*parseFloat(preco);
		 $('#sb'+p+d).val(subtotal);
		 $('#r'+p).text('KZ '+ Dec(subtotal))
		 
		 var imposto = parseFloat(qtd)* parseFloat(imp)*parseFloat(preco)
		 $('#impo'+p+d).val(parseFloat(imposto).toFixed(2));
		 
		 }
	 }else if(parseFloat(qtd)>parseFloat(st)){
		 Swal.fire({
             title: "Quantidade indisponivel ",
             text: "",
             icon: "warning"
         });
		
		 var qtd= $('#qtd'+p).val(st);
		 var subtotal= parseFloat(st)*parseFloat(preco);
		 $('#sb'+p).val(subtotal);
		 $('#r'+p).text('KZ '+ Dec(subtotal))
	 }
	 
	 
	 
	   $('[class^="sbt'+d+'"]').each(function () {
	        total += parseFloat($(this).val() || 0); 
	    });
	 
	   $('#total'+d).text('KZ '+ Dec(total))
	   $('#totall'+d).val(total)
	   
	   
	    $('[class^="impo'+d+'"]').each(function () {
	        impos += parseFloat($(this).val() || 0); 
	    });
	 
	   $('#impp'+d).text('KZ '+ Dec(impos))
	   $('#imppo'+d).val(impos)
	   
	   //txs= 0.05*$('#totall'+d).val()
	   ipp($('#totall'+d).val(),d)
	   
// 	   console.log($('#imppo'+d).val())
// 	   console.log(total)
// 	   console.log($('#txx'+d).val())
	   
	   var totalito = impos+ total+ parseFloat($('#txx'+d).val());
	   
	   $('#i'+d).text('KZ '+ Dec(totalito))
	   $('#im'+d).val(totalito.toFixed(2))
	   
	      $('#stx'+d).val((impos+total).toFixed(2))
	   
	   
// 	  if( parseFloat($('#totall'+d).val())==0){
// 		   txs=0;
// 	  } else if( parseFloat($('#totall'+d).val())<10001){
// 		   txs=1000;
		  
// 	   }else if(parseFloat($('#totall'+d).val())<20001) {
// 		   txs=2000;
		   
// 	   }else if(parseFloat($('#totall'+d).val())<30001) {
// 		   txs=3000;
		   
// 	   }else if(parseFloat($('#totall'+d).val())<40001) {
// 		   txs=4000;
		   
// 	   }else if(parseFloat($('#totall'+d).val())<50001) {
// 		   txs=5000;
		   
// 	   }else if(parseFloat($('#totall'+d).val())>50000) {
// 		   txs=6000;
		   
// 	   }
	   
	   
// 	   $('#txx'+d).val(txs.toFixed(2))
// 	   $('#tx'+d).text('KZ '+ Dec(txs))
  }
  
  function RemovePV(str_valor){
		 var imp =  str_valor.replaceAll(".", "")
	    return  imp.replace(",",".")       
	}
	function Dec(valor){
		
		var val= new Number(valor);
		var decimal=val.toLocaleString("pt-BR",{
			minimumFractionDigits:2,
			maximumFractionDigits:2});
			return decimal;

	}
	
	
	 function mos(p,d){
		 
		      if ($('#checkbox'+p+d).is(':checked')) {
		        $('#qtdx'+p).show();
		        $('#rx'+p).show();
		     
		        $('#ip'+p).val(p);

		        
		        
		      } else   {
		    	  $('#qtdx'+p).hide();
		    	  
		    	  
		    	  if($('#totall'+d).val()>0){
		    		  
		    		//  alert('total '+$('#totall'+d).val() +'  sudde '+$('#sb'+p+d).val());
		    	 var tr = parseFloat($('#totall'+d).val()) - parseFloat($('#sb'+p+d).val())
		    	
		    	   $('#total'+d).text('KZ '+ Dec(tr.toFixed(2)))
		    	  $('#totall'+d).val(tr.toFixed(2))
		    	 
		    	  
		    	   var impr = parseFloat($('#imppo'+d).val()) - parseFloat($('#impo'+p+d).val())
		    	   
		    	    $('#impp'+d).text('KZ '+ Dec(impr.toFixed(2)))
		    	   $('#imppo'+d).val(impr.toFixed(2))
		    	   
		    
// 		    		  txs= 0.05*$('#totall'+d).val()
// 		    		   $('#txx'+d).val(txs)
// 		    		   $('#tx'+d).text('KZ '+ Dec(txs))
		    	  
		    	   ipp($('#totall'+d).val(),d)
		    	  
		    	   
		    	   var ttt= parseFloat($('#im'+d).val())-( parseFloat($('#sb'+p+d).val())+ parseFloat($('#impo'+p+d).val())+ parseFloat(0.05*$('#sb'+p+d).val())  )
		    	   
		    	   $('#i'+d).text('KZ '+ Dec(ttt))
	   			   $('#im'+d).val(ttt.toFixed(2))
		    	   
	   			   $('#stx'+d).val((parseFloat($('#stx'+d).val()-parseFloat($('#sb'+p+d).val())+ parseFloat($('#impo'+p+d).val()))).toFixed(2))
	   			   
		    	  }
		    	  $('#ip'+p).val('');
		    	 $('#qtd'+p).val('0');
		    	  $('#sb'+p).val('0');
		    	  $('#r'+p).text('0,00');
		    	  $('#sb'+p+d).val('0')
		    	  $('#rx'+p).hide();}
		     
		 
	  }
	 
	 
	 function ipp(p,d){
		 
		 txs= 0.05*p
		   $('#txx'+d).val(txs.toFixed(2))
		   $('#tx'+d).text('KZ '+ Dec(txs.toFixed(2)))
		 
		   return txs.toFixed(2);
	 }
	 
	 function rejeitar(p){
			//alert(p)
			
			 Swal.fire({
				  title: 'Tem a certeza ?',
				  text: "Este processo é irreversivel",
				  icon: 'warning',
				  showCancelButton: true,
				  confirmButtonColor: '#3085d6',
				  cancelButtonColor: '#d33',
				  confirmButtonText: 'Sim, rejeitar proposta!',
				   cancelButtonText: 'Cancelar'
				}).then((result) => {
				  if (result.isConfirmed) {
					  
					  
					  $.ajax({
			                type: 'POST',
			                url: '/rejeitarproposta/'+ p,
			                success: function () {
			                    Swal.fire(
			                    	'Proposta Rejeitada!',
			                        '',
			                        'success'
			                    ).then(() => {
			                        location.reload(); // Atualiza a página após o encerramento do pacote
			                    });
			                },
			                error: function () {
			                    Swal.fire(
			                        'Erro!',
			                        'Ocorreu um erro ao encerrar o pacote.',
			                        'error'
			                    );
			                }
			            });
					  
					  
					  
					  
					  
// 					  var delay=1300;
// 					  setTimeout(function(){
					 
// 						  window.location.href='/rejeitarproposta/'+ p;
// 					  },delay);
// 				    Swal.fire(
// 				      'Proposta rejeitada!',
// 				      '',
// 				      'success'
// 				    ).then(()=>{ window.location.reload()})
				  }
				})
			
			
		}
	
	function negar(p){
		//alert(p)
		
		 Swal.fire({
			  title: 'Tem a certeza ?',
			  text: "Este processo é irreversivel",
			  icon: 'warning',
			  showCancelButton: true,
			  confirmButtonColor: '#3085d6',
			  cancelButtonColor: '#d33',
			  confirmButtonText: 'Sim, negar entrega!',
			   cancelButtonText: 'Cancelar'
			}).then((result) => {
			  if (result.isConfirmed) {
				  var delay=1300;
				  setTimeout(function(){
				 
					  window.location.href='/negarentrega/'+ p;
				  },delay);
			    Swal.fire(
			      'Entrega negada!',
			      '',
			      'success'
			    ).then(()=>{ window.location.reload()})
			  }
			})
		
		
	}
	
	
	function confirmar(p,a){
		//alert(a)
		  Swal.fire({
			  title: 'Tem a certeza ?',
			  text: "Este processo é irreversivel",
			  icon: 'warning',
			  showCancelButton: true,
			  confirmButtonColor: '#3085d6',
			  cancelButtonColor: '#d33',
			  confirmButtonText: 'Sim, confirmar entrega!',
			   cancelButtonText: 'Cancelar'
			}).then((result) => {
				
				 $.ajax({
		                type: 'POST',
		                url: '/confirmarentrega/'+ p+'/'+a,
		                success: function () {
		                    Swal.fire(
		                    	'Entrega confirmada!',
		                        '',
		                        'success'
		                    ).then(() => {
		                        location.reload(); // Atualiza a página após o encerramento do pacote
		                    });
		                },
		                error: function () {
		                    Swal.fire(
		                        'Erro!',
		                        'Ocorreu um erro ao encerrar o pacote.',
		                        'error'
		                    );
		                }
		            });
			})		
	}
	
  </script>
</body>
</html>